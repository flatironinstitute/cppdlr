\doxysection{dlr\+\_\+imtime.\+hpp}
\hypertarget{dlr__imtime_8hpp_source}{}\label{dlr__imtime_8hpp_source}\index{/home/runner/work/cppdlr/cppdlr/c++/cppdlr/dlr\_imtime.hpp@{/home/runner/work/cppdlr/cppdlr/c++/cppdlr/dlr\_imtime.hpp}}
\mbox{\hyperlink{dlr__imtime_8hpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ Copyright\ (c)\ 2022-\/2023\ Simons\ Foundation}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ Copyright\ (c)\ 2023\ Hugo\ Strand}}
\DoxyCodeLine{00003\ \textcolor{comment}{//}}
\DoxyCodeLine{00004\ \textcolor{comment}{//\ Licensed\ under\ the\ Apache\ License,\ Version\ 2.0\ (the\ "{}License"{});}}
\DoxyCodeLine{00005\ \textcolor{comment}{//\ you\ may\ not\ use\ this\ file\ except\ in\ compliance\ with\ the\ License.}}
\DoxyCodeLine{00006\ \textcolor{comment}{//\ You\ may\ obtain\ a\ copy\ of\ the\ License\ at}}
\DoxyCodeLine{00007\ \textcolor{comment}{//}}
\DoxyCodeLine{00008\ \textcolor{comment}{//\ \ \ \ \ http://www.apache.org/licenses/LICENSE-\/2.0.txt}}
\DoxyCodeLine{00009\ \textcolor{comment}{//}}
\DoxyCodeLine{00010\ \textcolor{comment}{//\ Unless\ required\ by\ applicable\ law\ or\ agreed\ to\ in\ writing,\ software}}
\DoxyCodeLine{00011\ \textcolor{comment}{//\ distributed\ under\ the\ License\ is\ distributed\ on\ an\ "{}AS\ IS"{}\ BASIS,}}
\DoxyCodeLine{00012\ \textcolor{comment}{//\ WITHOUT\ WARRANTIES\ OR\ CONDITIONS\ OF\ ANY\ KIND,\ either\ express\ or\ implied.}}
\DoxyCodeLine{00013\ \textcolor{comment}{//\ See\ the\ License\ for\ the\ specific\ language\ governing\ permissions\ and}}
\DoxyCodeLine{00014\ \textcolor{comment}{//\ limitations\ under\ the\ License.}}
\DoxyCodeLine{00015\ \textcolor{comment}{//}}
\DoxyCodeLine{00016\ \textcolor{comment}{//\ Authors:\ Hugo\ U.\ R.\ Strand,\ Nils\ Wentzell,\ Jason\ Kaye}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ <nda/nda.hpp>}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{dlr__kernels_8hpp}{cppdlr/dlr\_kernels.hpp}}"{}}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{dlr__build_8hpp}{cppdlr/dlr\_build.hpp}}"{}}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{utils_8hpp}{cppdlr/utils.hpp}}"{}}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ "{}nda/clef/clef.hpp"{}}}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ <h5/h5.hpp>}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#include\ <nda/h5.hpp>}}
\DoxyCodeLine{00027\ }
\DoxyCodeLine{00028\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacecppdlr}{cppdlr}}\ \{}
\DoxyCodeLine{00029\ }
\DoxyCodeLine{00030\ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{auto}\ \_\ =\ nda::range::all;}
\DoxyCodeLine{00031\ }
\DoxyCodeLine{00035\ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ \textcolor{keywordtype}{bool}\ ORDINARY\ =\ \textcolor{keyword}{false},\ TIME\_ORDERED\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00036\ }
\DoxyCodeLine{00046\ \ \ \textcolor{keyword}{class\ }\mbox{\hyperlink{classcppdlr_1_1imtime__ops}{imtime\_ops}}\ \{}
\DoxyCodeLine{00047\ }
\DoxyCodeLine{00048\ \ \ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00057\ \ \ \ \ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a8da78cf54d39d48d2be19ad1f146b03c}{imtime\_ops}}(\textcolor{keywordtype}{double}\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a401521dedc309ca12c1ec345da983c80}{lambda}},\ nda::vector\_const\_view<double>\ dlr\_rf,\ \textcolor{keywordtype}{bool}\ symmetrize);}
\DoxyCodeLine{00058\ }
\DoxyCodeLine{00065\ \ \ \ \ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a8da78cf54d39d48d2be19ad1f146b03c}{imtime\_ops}}(\textcolor{keywordtype}{double}\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a401521dedc309ca12c1ec345da983c80}{lambda}},\ nda::vector\_const\_view<double>\ dlr\_rf);}
\DoxyCodeLine{00066\ }
\DoxyCodeLine{00067\ \ \ \ \ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a43a9b5fb6aeefad7d8ae6865329e69de}{imtime\_ops}}(\textcolor{keywordtype}{double}\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a401521dedc309ca12c1ec345da983c80}{lambda}},\ nda::vector\_const\_view<double>\ dlr\_rf,\ nda::vector\_const\_view<double>\ dlr\_it,\ nda::matrix\_const\_view<double>\ cf2it,}
\DoxyCodeLine{00068\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ nda::matrix\_const\_view<double>\ it2cf\_lu,\ nda::vector\_const\_view<int>\ it2cf\_piv)}
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ :\ lambda\_(\mbox{\hyperlink{classcppdlr_1_1imtime__ops_a401521dedc309ca12c1ec345da983c80}{lambda}}),\ r(dlr\_rf.size()),\ dlr\_rf(dlr\_rf),\ dlr\_it(dlr\_it),\ cf2it(cf2it),\ it2cf\{it2cf\_lu,\ it2cf\_lu,\ it2cf\_piv\}\ \{\};}
\DoxyCodeLine{00070\ }
\DoxyCodeLine{00071\ \ \ \ \ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a8da78cf54d39d48d2be19ad1f146b03c}{imtime\_ops}}()\ =\ \textcolor{keywordflow}{default};}
\DoxyCodeLine{00072\ }
\DoxyCodeLine{00101\ \ \ \ \ \textcolor{keyword}{template}\ <nda::MemoryArray\ T,\ nda::Scalar\ S\ =\ nda::get\_value\_t<T>>\ \textcolor{keyword}{typename}\ T::regular\_type\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_af5bafac0dcc76bd713c732a3792c6e0c}{vals2coefs}}(T\ \textcolor{keyword}{const}\ \&g,\ \textcolor{keywordtype}{bool}\ transpose\ =\ \textcolor{keyword}{false})\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00102\ }
\DoxyCodeLine{00103\ \ \ \ \ \ \ \textcolor{comment}{//\ MemoryArray\ type\ can\ be\ nda\ vector,\ matrix,\ array,\ or\ view\ of\ any\ of}}
\DoxyCodeLine{00104\ \ \ \ \ \ \ \textcolor{comment}{//\ these;\ taking\ a\ regular\_type\ converts,\ for\ example,\ a\ matrix\ view\ to\ a}}
\DoxyCodeLine{00105\ \ \ \ \ \ \ \textcolor{comment}{//\ matrix.}}
\DoxyCodeLine{00106\ }
\DoxyCodeLine{00107\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (r\ !=\ g.shape(0))\ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}First\ dim\ of\ g\ !=\ DLR\ rank\ r."{}});}
\DoxyCodeLine{00108\ }
\DoxyCodeLine{00109\ \ \ \ \ \ \ \textcolor{comment}{//\ Make\ a\ copy\ of\ the\ data\ in\ Fortran\ Layout\ as\ required\ by\ getrs}}
\DoxyCodeLine{00110\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ gf\ =\ nda::array<nda::get\_value\_t<T>,\ nda::get\_rank<T>,\ nda::F\_layout>(g);}
\DoxyCodeLine{00111\ }
\DoxyCodeLine{00112\ \ \ \ \ \ \ \textcolor{comment}{//\ Reshape\ as\ matrix\_view\ with\ r\ rows}}
\DoxyCodeLine{00113\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ gfv\ =\ nda::reshape(gf,\ r,\ g.size()\ /\ r);}
\DoxyCodeLine{00114\ }
\DoxyCodeLine{00115\ \ \ \ \ \ \ \textcolor{comment}{//\ Solve\ linear\ system\ (multiple\ right\ hand\ sides)\ to\ convert\ vals\ -\/>\ coeffs}}
\DoxyCodeLine{00116\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}\ (nda::is\_complex\_v<S>)\ \{\ \textcolor{comment}{//\ getrs\ requires\ matrix\ and\ rhs\ to\ have\ same\ value\ type}}
\DoxyCodeLine{00117\ \ \ \ \ \ \ \ \ transpose\ ?\ nda::lapack::getrs(nda::transpose(it2cf.zlu),\ gfv,\ it2cf.piv)\ :\ nda::lapack::getrs(it2cf.zlu,\ gfv,\ it2cf.piv);}
\DoxyCodeLine{00118\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00119\ \ \ \ \ \ \ \ \ transpose\ ?\ nda::lapack::getrs(nda::transpose(it2cf.lu),\ gfv,\ it2cf.piv)\ :\ nda::lapack::getrs(it2cf.lu,\ gfv,\ it2cf.piv);}
\DoxyCodeLine{00120\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00121\ }
\DoxyCodeLine{00122\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ gf;}
\DoxyCodeLine{00123\ \ \ \ \ \}}
\DoxyCodeLine{00124\ }
\DoxyCodeLine{00133\ \ \ \ \ \textcolor{keyword}{template}\ <nda::MemoryArray\ T,\ nda::Scalar\ S\ =\ nda::get\_value\_t<T>>\ \textcolor{keyword}{typename}\ T::regular\_type\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a6f6d71c061aec134df9edf1255e19dfb}{coefs2vals}}(T\ \textcolor{keyword}{const}\ \&gc)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00134\ }
\DoxyCodeLine{00135\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (r\ !=\ gc.shape(0))\ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}First\ dim\ of\ g\ !=\ DLR\ rank\ r."{}});}
\DoxyCodeLine{00136\ }
\DoxyCodeLine{00137\ \ \ \ \ \ \ \textcolor{comment}{//\ Reshape\ gc\ to\ a\ matrix\ w/\ first\ dimension\ r}}
\DoxyCodeLine{00138\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ gc\_rs\ =\ nda::reshape(gc,\ r,\ gc.size()\ /\ r);}
\DoxyCodeLine{00139\ }
\DoxyCodeLine{00140\ \ \ \ \ \ \ \textcolor{comment}{//\ Apply\ coeffs\ -\/>\ vals\ matrix}}
\DoxyCodeLine{00141\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ g\ =\ cf2it\ *\ nda::matrix\_const\_view<S>(gc\_rs);}
\DoxyCodeLine{00142\ }
\DoxyCodeLine{00143\ \ \ \ \ \ \ \textcolor{comment}{//\ Reshape\ to\ original\ dimensions\ and\ return}}
\DoxyCodeLine{00144\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ nda::reshape(g,\ gc.shape());}
\DoxyCodeLine{00145\ \ \ \ \ \}}
\DoxyCodeLine{00146\ }
\DoxyCodeLine{00161\ \ \ \ \ \textcolor{keyword}{template}\ <nda::MemoryArray\ T,\ nda::Scalar\ S\ =\ nda::get\_value\_t<T>>\ \textcolor{keyword}{auto}\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a12761a877407fc347dc695da4b2d7f3d}{coefs2eval}}(T\ \textcolor{keyword}{const}\ \&gc,\ \textcolor{keywordtype}{double}\ t)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00162\ }
\DoxyCodeLine{00163\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (r\ !=\ gc.shape(0))\ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}First\ dim\ of\ g\ !=\ DLR\ rank\ r."{}});}
\DoxyCodeLine{00164\ }
\DoxyCodeLine{00165\ \ \ \ \ \ \ \textcolor{comment}{//\ Scalar-\/valued\ Green's\ functions\ are\ handled\ differently\ than\ matrix-\/valued\ Green's\ functions}}
\DoxyCodeLine{00166\ }
\DoxyCodeLine{00167\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}\ (T::rank\ ==\ 1)\ \{}
\DoxyCodeLine{00168\ }
\DoxyCodeLine{00169\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ TODO:\ can\ be\ further\ optimized\ to\ reduce\ \#\ exponential\ evals.}}
\DoxyCodeLine{00170\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Evaluate\ DLR\ expansion}}
\DoxyCodeLine{00171\ \ \ \ \ \ \ \ \ S\ g\ =\ 0;}
\DoxyCodeLine{00172\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (t\ >=\ 0)\ \{}
\DoxyCodeLine{00173\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ l\ =\ 0;\ l\ <\ r;\ ++l)\ \{\ g\ +=\ \mbox{\hyperlink{namespacecppdlr_a7dfaf907221eb1768418258421af703f}{k\_it\_abs}}(t,\ dlr\_rf(l))\ *\ gc(l);\ \}}
\DoxyCodeLine{00174\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00175\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ l\ =\ 0;\ l\ <\ r;\ ++l)\ \{\ g\ +=\ \mbox{\hyperlink{namespacecppdlr_a7dfaf907221eb1768418258421af703f}{k\_it\_abs}}(-\/t,\ -\/dlr\_rf(l))\ *\ gc(l);\ \}}
\DoxyCodeLine{00176\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00177\ }
\DoxyCodeLine{00178\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ g;}
\DoxyCodeLine{00179\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00180\ }
\DoxyCodeLine{00181\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Reshape\ gc\ to\ matrix\ w/\ first\ dimension\ r}}
\DoxyCodeLine{00182\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ gc\_rs\ =\ nda::reshape(gc,\ r,\ gc.size()\ /\ r);}
\DoxyCodeLine{00183\ }
\DoxyCodeLine{00184\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Get\ output\ shape}}
\DoxyCodeLine{00185\ \ \ \ \ \ \ \ \ std::array<long,\ T::rank\ -\/\ 1>\ shape\_out;}
\DoxyCodeLine{00186\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ T::rank\ -\/\ 1;\ ++i)\ \{\ shape\_out[i]\ =\ gc.shape(i\ +\ 1);\ \}}
\DoxyCodeLine{00187\ }
\DoxyCodeLine{00188\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Get\ vector\ of\ evaluation\ of\ DLR\ expansion\ at\ a\ point}}
\DoxyCodeLine{00189\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ kvec\ =\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a318b0b4409d0488814bb8db12c8b0611}{build\_evalvec}}(t);}
\DoxyCodeLine{00190\ }
\DoxyCodeLine{00191\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Evaluate\ DLR\ expansion,\ reshape\ to\ original\ dimensions\ (with\ first}}
\DoxyCodeLine{00192\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ dimension\ summed\ out),\ and\ return}}
\DoxyCodeLine{00193\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ nda::reshape(transpose(nda::matrix\_const\_view<S>(gc\_rs))\ *\ kvec,\ shape\_out);}
\DoxyCodeLine{00194\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00195\ \ \ \ \ \}}
\DoxyCodeLine{00196\ }
\DoxyCodeLine{00209\ \ \ \ \ nda::vector<double>\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a318b0b4409d0488814bb8db12c8b0611}{build\_evalvec}}(\textcolor{keywordtype}{double}\ t)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00210\ }
\DoxyCodeLine{00220\ \ \ \ \ \textcolor{keyword}{template}\ <nda::MemoryArray\ T,\ nda::Scalar\ S\ =\ nda::get\_value\_t<T>>}
\DoxyCodeLine{00221\ \ \ \ \ \textcolor{keyword}{typename}\ T::regular\_type\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a6a81a99b2858defa9513a395bd35e2bf}{fitvals2coefs}}(nda::vector\_const\_view<double>\ t,\ T\ \textcolor{keyword}{const}\ \&g)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00222\ }
\DoxyCodeLine{00223\ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ first\ dimension\ of\ g\ equal\ to\ length\ of\ t}}
\DoxyCodeLine{00224\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ n\ =\ t.size();}
\DoxyCodeLine{00225\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (n\ !=\ g.shape(0))\ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}First\ dim\ of\ g\ must\ be\ equal\ to\ length\ of\ t."{}});}
\DoxyCodeLine{00226\ }
\DoxyCodeLine{00227\ \ \ \ \ \ \ \textcolor{comment}{//\ Get\ matrix\ for\ least\ squares\ fitting:\ columns\ are\ DLR\ basis\ functions}}
\DoxyCodeLine{00228\ \ \ \ \ \ \ \textcolor{comment}{//\ evaluating\ at\ data\ points\ t.\ Must\ built\ in\ Fortran\ layout\ for}}
\DoxyCodeLine{00229\ \ \ \ \ \ \ \textcolor{comment}{//\ compatibility\ with\ LAPACK.}}
\DoxyCodeLine{00230\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ kmat\ =\ nda::matrix<S,\ nda::F\_layout>(n,\ r);\ \textcolor{comment}{//\ Make\ sure\ matrix\ has\ same\ scalar\ type\ as\ g}}
\DoxyCodeLine{00231\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ j\ =\ 0;\ j\ <\ r;\ ++j)\ \{}
\DoxyCodeLine{00232\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ n;\ ++i)\ \{\ kmat(i,\ j)\ =\ \mbox{\hyperlink{namespacecppdlr_afc9726e02898098dfff8448f02f5b3c6}{k\_it}}(t(i),\ dlr\_rf(j));\ \}}
\DoxyCodeLine{00233\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00234\ }
\DoxyCodeLine{00235\ \ \ \ \ \ \ \textcolor{comment}{//\ Reshape\ g\ to\ matrix\ w/\ first\ dimension\ n,\ and\ put\ in\ Fortran\ layout\ for}}
\DoxyCodeLine{00236\ \ \ \ \ \ \ \textcolor{comment}{//\ compatibility\ w/\ LAPACK}}
\DoxyCodeLine{00237\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ g\_rs\ =\ nda::matrix<S,\ nda::F\_layout>(nda::reshape(g,\ n,\ g.size()\ /\ n));}
\DoxyCodeLine{00238\ }
\DoxyCodeLine{00239\ \ \ \ \ \ \ \textcolor{comment}{//\ Solve\ least\ squares\ problem\ to\ obtain\ DLR\ coefficients}}
\DoxyCodeLine{00240\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ s\ \ \ =\ nda::vector<double>(r);\ \textcolor{comment}{//\ Singular\ values\ (not\ needed)}}
\DoxyCodeLine{00241\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a88f437cb31c98929ab8a1e6dadb174aa}{rank}}\ =\ 0;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Rank\ of\ system\ matrix\ (not\ needed)}}
\DoxyCodeLine{00242\ \ \ \ \ \ \ nda::lapack::gelss(kmat,\ g\_rs,\ s,\ 0.0,\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a88f437cb31c98929ab8a1e6dadb174aa}{rank}});}
\DoxyCodeLine{00243\ }
\DoxyCodeLine{00244\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ gc\_shape\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ =\ g.shape();\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Output\ shape\ is\ same\ as\ g...}}
\DoxyCodeLine{00245\ \ \ \ \ \ \ gc\_shape[0]\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ =\ r;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ ...with\ first\ dimension\ n\ replaced\ by\ r}}
\DoxyCodeLine{00246\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ gc\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ =\ \textcolor{keyword}{typename}\ T::regular\_type(gc\_shape);\ \textcolor{comment}{//\ Output\ array:\ output\ type\ is\ same\ as\ g}}
\DoxyCodeLine{00247\ \ \ \ \ \ \ reshape(gc,\ r,\ g.size()\ /\ n)\ =\ g\_rs(nda::range(r),\ \_);\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Place\ result\ in\ output\ array}}
\DoxyCodeLine{00248\ }
\DoxyCodeLine{00249\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ gc;}
\DoxyCodeLine{00250\ \ \ \ \ \}}
\DoxyCodeLine{00251\ }
\DoxyCodeLine{00263\ \ \ \ \ \textcolor{keyword}{template}\ <nda::MemoryArray\ T>\ \textcolor{keyword}{typename}\ T::regular\_type\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a0ee9bfed6fc9facf2d25cea9868a3af6}{reflect}}(T\ \textcolor{keyword}{const}\ \&g)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00264\ }
\DoxyCodeLine{00265\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (r\ !=\ g.shape(0))\ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}First\ dim\ of\ g\ !=\ DLR\ rank\ r."{}});}
\DoxyCodeLine{00266\ }
\DoxyCodeLine{00267\ \ \ \ \ \ \ \textcolor{comment}{//\ Initialize\ reflection\ matrix,\ if\ it\ hasn't\ been\ done\ already}}
\DoxyCodeLine{00268\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (refl.empty())\ \{\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a3a47942235e7330cc6d392dc881d256f}{reflect\_init}}();\ \}}
\DoxyCodeLine{00269\ }
\DoxyCodeLine{00270\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}\ (T::rank\ ==\ 1)\ \{\ \textcolor{comment}{//\ Scalar-\/valued\ Green's\ function}}
\DoxyCodeLine{00271\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ matmul(refl,\ g);}
\DoxyCodeLine{00272\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00273\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ gr\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ =\ \textcolor{keyword}{typename}\ T::regular\_type(g.shape());\ \ \ \ \ \ \ \textcolor{comment}{//\ Output\ has\ same\ type/shape\ as\ g}}
\DoxyCodeLine{00274\ \ \ \ \ \ \ \ \ reshape(gr,\ r,\ g.size()\ /\ r)\ =\ matmul(refl,\ reshape(g,\ r,\ g.size()\ /\ r));\ \textcolor{comment}{//\ Reshape,\ matrix\ multiply,\ reshape\ back}}
\DoxyCodeLine{00275\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ gr;}
\DoxyCodeLine{00276\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00277\ \ \ \ \ \}}
\DoxyCodeLine{00278\ }
\DoxyCodeLine{00308\ \ \ \ \ \textcolor{keyword}{template}\ <nda::MemoryArray\ T,\ nda::Scalar\ S\ =\ nda::get\_value\_t<T>>}
\DoxyCodeLine{00309\ \ \ \ \ \textcolor{keyword}{typename}\ T::regular\_type\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a4f018cf316547b2879d9a2dd76a4b80c}{convolve}}(\textcolor{keywordtype}{double}\ beta,\ \mbox{\hyperlink{namespacecppdlr_ad0a7e33d9a03f4986937032c25ee7435}{statistic\_t}}\ statistic,\ T\ \textcolor{keyword}{const}\ \&fc,\ T\ \textcolor{keyword}{const}\ \&gc,\ \textcolor{keywordtype}{bool}\ time\_order\ =\ \textcolor{keyword}{false})\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00310\ }
\DoxyCodeLine{00311\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (r\ !=\ fc.shape(0)\ ||\ r\ !=\ gc.shape(0))\ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}First\ dim\ of\ input\ arrays\ must\ be\ equal\ to\ DLR\ rank\ r."{}});}
\DoxyCodeLine{00312\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (fc.shape()\ !=\ gc.shape())\ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}Input\ arrays\ must\ have\ the\ same\ shape."{}});}
\DoxyCodeLine{00313\ }
\DoxyCodeLine{00314\ \ \ \ \ \ \ \textcolor{comment}{//\ TODO:\ implement\ bosonic\ case\ and\ remove}}
\DoxyCodeLine{00315\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (statistic\ ==\ 0)\ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}imtime\_ops::convolve\ not\ yet\ implemented\ for\ bosonic\ Green's\ functions."{}});}
\DoxyCodeLine{00316\ }
\DoxyCodeLine{00317\ \ \ \ \ \ \ \textcolor{comment}{//\ Initialize\ convolution,\ if\ it\ hasn't\ been\ done\ already}}
\DoxyCodeLine{00318\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!time\_order\ \&\ hilb.empty())\ \{\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a6257e0b3f43733c5ac06c8af11a47bb3}{convolve\_init}}();\ \}}
\DoxyCodeLine{00319\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (time\_order\ \&\ thilb.empty())\ \{\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_ae6116f42e1f17050404974d0d6d3d226}{tconvolve\_init}}();\ \}}
\DoxyCodeLine{00320\ }
\DoxyCodeLine{00321\ \ \ \ \ \ \ \textcolor{comment}{//\ Get\ view\ of\ helper\ matrices\ based\ on\ time\_order\ flag}}
\DoxyCodeLine{00322\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ hilb\_v\ \ \ =\ (time\_order\ ?\ nda::matrix\_const\_view<double>(thilb)\ :\ nda::matrix\_const\_view<double>(hilb));}
\DoxyCodeLine{00323\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ tcf2it\_v\ =\ (time\_order\ ?\ nda::matrix\_const\_view<double>(ttcf2it)\ :\ nda::matrix\_const\_view<double>(tcf2it));}
\DoxyCodeLine{00324\ }
\DoxyCodeLine{00325\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}\ (T::rank\ ==\ 1)\ \{\ \textcolor{comment}{//\ Scalar-\/valued\ Green's\ function}}
\DoxyCodeLine{00326\ }
\DoxyCodeLine{00327\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Take\ array\ view\ of\ fc\ and\ gc}}
\DoxyCodeLine{00328\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ fca\ =\ nda::array\_const\_view<S,\ 1>(fc);}
\DoxyCodeLine{00329\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ gca\ =\ nda::array\_const\_view<S,\ 1>(gc);}
\DoxyCodeLine{00330\ }
\DoxyCodeLine{00331\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Diagonal\ contribution}}
\DoxyCodeLine{00332\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ h\ =\ matvecmul(tcf2it\_v,\ make\_regular(fca\ *\ gca));}
\DoxyCodeLine{00333\ }
\DoxyCodeLine{00334\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Off-\/diagonal\ contribution}}
\DoxyCodeLine{00335\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ tmp\ =\ fca\ *\ \mbox{\hyperlink{namespacecppdlr_a623b3f78817239e2d1653be8972cc5f1}{arraymult}}(hilb\_v,\ gca)\ +\ gca\ *\ \mbox{\hyperlink{namespacecppdlr_a623b3f78817239e2d1653be8972cc5f1}{arraymult}}(hilb\_v,\ fca);}
\DoxyCodeLine{00336\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ beta\ *\ (h\ +\ matvecmul(cf2it,\ make\_regular(tmp)));}
\DoxyCodeLine{00337\ }
\DoxyCodeLine{00338\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (T::rank\ ==\ 3)\ \{\ \textcolor{comment}{//\ Matrix-\/valued\ Green's\ function}}
\DoxyCodeLine{00339\ }
\DoxyCodeLine{00340\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Diagonal\ contribution}}
\DoxyCodeLine{00341\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ fcgc\ =\ nda::array<S,\ 3>(fc.shape());\ \textcolor{comment}{//\ Product\ of\ coefficients\ of\ f\ and\ g}}
\DoxyCodeLine{00342\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ r;\ ++i)\ \{\ fcgc(i,\ \_,\ \_)\ =\ matmul(fc(i,\ \_,\ \_),\ gc(i,\ \_,\ \_));\ \}}
\DoxyCodeLine{00343\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ h\ =\ \mbox{\hyperlink{namespacecppdlr_a623b3f78817239e2d1653be8972cc5f1}{arraymult}}(tcf2it\_v,\ fcgc);}
\DoxyCodeLine{00344\ }
\DoxyCodeLine{00345\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Off-\/diagonal\ contribution}}
\DoxyCodeLine{00346\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ tmp1\ =\ \mbox{\hyperlink{namespacecppdlr_a623b3f78817239e2d1653be8972cc5f1}{arraymult}}(hilb\_v,\ fc);}
\DoxyCodeLine{00347\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ tmp2\ =\ \mbox{\hyperlink{namespacecppdlr_a623b3f78817239e2d1653be8972cc5f1}{arraymult}}(hilb\_v,\ gc);}
\DoxyCodeLine{00348\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ r;\ ++i)\ \{\ tmp1(i,\ \_,\ \_)\ =\ matmul(tmp1(i,\ \_,\ \_),\ gc(i,\ \_,\ \_))\ +\ matmul(fc(i,\ \_,\ \_),\ tmp2(i,\ \_,\ \_));\ \}}
\DoxyCodeLine{00349\ }
\DoxyCodeLine{00350\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ beta\ *\ (h\ +\ \mbox{\hyperlink{namespacecppdlr_a623b3f78817239e2d1653be8972cc5f1}{arraymult}}(cf2it,\ tmp1));}
\DoxyCodeLine{00351\ }
\DoxyCodeLine{00352\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00353\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}Input\ arrays\ must\ be\ rank\ 1\ (scalar-\/valued\ Green's\ function)\ or\ 3\ (matrix-\/valued\ Green's\ function)."{}});}
\DoxyCodeLine{00354\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00355\ \ \ \ \ \}}
\DoxyCodeLine{00356\ }
\DoxyCodeLine{00378\ \ \ \ \ \textcolor{keyword}{template}\ <nda::MemoryMatrix\ Tf,\ nda::MemoryArray\ Tg,\ nda::Scalar\ Sf\ =\ nda::get\_value\_t<Tf>,\ nda::Scalar\ Sg\ =\ nda::get\_value\_t<Tg>,}
\DoxyCodeLine{00379\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ nda::Scalar\ S\ =\ \textcolor{keyword}{typename}\ std::common\_type<Sf,\ Sg>::type>}
\DoxyCodeLine{00380\ \ \ \ \ \textcolor{keyword}{typename}\ Tg::regular\_type\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a87b3e21ae66c97691a4580335795f77f}{convolve}}(Tf\ \textcolor{keyword}{const}\ \&fconv,\ Tg\ \textcolor{keyword}{const}\ \&g)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00381\ }
\DoxyCodeLine{00382\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (r\ !=\ g.shape(0))\ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}First\ dim\ of\ input\ g\ must\ be\ equal\ to\ DLR\ rank\ r."{}});}
\DoxyCodeLine{00383\ }
\DoxyCodeLine{00384\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}\ (Tg::rank\ ==\ 1)\ \{\ \textcolor{comment}{//\ Scalar-\/valued\ Green's\ function}}
\DoxyCodeLine{00385\ }
\DoxyCodeLine{00386\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (fconv.shape(1)\ !=\ g.shape(0))\ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}Input\ array\ dimensions\ incompatible."{}});}
\DoxyCodeLine{00387\ }
\DoxyCodeLine{00388\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ matvecmul(fconv,\ g);}
\DoxyCodeLine{00389\ }
\DoxyCodeLine{00390\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (Tg::rank\ ==\ 3)\ \{\ \textcolor{comment}{//\ Matrix-\/valued\ Green's\ function}}
\DoxyCodeLine{00391\ }
\DoxyCodeLine{00392\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (fconv.shape(1)\ !=\ g.shape(0)\ *\ g.shape(1))\ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}Input\ array\ dimensions\ incompatible."{}});}
\DoxyCodeLine{00393\ }
\DoxyCodeLine{00394\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ norb1\ =\ g.shape(1);}
\DoxyCodeLine{00395\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ norb2\ =\ g.shape(2);}
\DoxyCodeLine{00396\ }
\DoxyCodeLine{00397\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ h\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ =\ nda::array<S,\ 3>(r,\ norb1,\ norb2);}
\DoxyCodeLine{00398\ \ \ \ \ \ \ \ \ reshape(h,\ r\ *\ norb1,\ norb2)\ =\ matmul(fconv,\ reshape(g,\ r\ *\ norb1,\ norb2));}
\DoxyCodeLine{00399\ }
\DoxyCodeLine{00400\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ h;}
\DoxyCodeLine{00401\ }
\DoxyCodeLine{00402\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00403\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}Input\ arrays\ must\ be\ rank\ 1\ (scalar-\/valued\ Green's\ function)\ or\ 3\ (matrix-\/valued\ Green's\ function)."{}});}
\DoxyCodeLine{00404\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00405\ \ \ \ \ \}}
\DoxyCodeLine{00406\ }
\DoxyCodeLine{00451\ \ \ \ \ \textcolor{keyword}{template}\ <nda::MemoryArray\ T,\ nda::Scalar\ S\ =\ nda::get\_value\_t<T>>}
\DoxyCodeLine{00452\ \ \ \ \ nda::matrix<S>\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a6c0a93f188f4522b2389e9a7fcbf9783}{convmat}}(\textcolor{keywordtype}{double}\ beta,\ \mbox{\hyperlink{namespacecppdlr_ad0a7e33d9a03f4986937032c25ee7435}{statistic\_t}}\ statistic,\ T\ \textcolor{keyword}{const}\ \&fc,\ \textcolor{keywordtype}{bool}\ time\_order\ =\ \textcolor{keyword}{false})\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00453\ }
\DoxyCodeLine{00454\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (r\ !=\ fc.shape(0))\ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}First\ dim\ of\ input\ array\ must\ be\ equal\ to\ DLR\ rank\ r."{}});}
\DoxyCodeLine{00455\ }
\DoxyCodeLine{00456\ \ \ \ \ \ \ \textcolor{comment}{//\ TODO:\ implement\ bosonic\ case\ and\ remove}}
\DoxyCodeLine{00457\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (statistic\ ==\ 0)\ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}imtime\_ops::convmat\ not\ yet\ implemented\ for\ bosonic\ Green's\ functions."{}});}
\DoxyCodeLine{00458\ }
\DoxyCodeLine{00459\ \ \ \ \ \ \ \textcolor{comment}{//\ Initialize\ convolution,\ if\ it\ hasn't\ been\ done\ already}}
\DoxyCodeLine{00460\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!time\_order\ \&\ hilb.empty())\ \{\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a6257e0b3f43733c5ac06c8af11a47bb3}{convolve\_init}}();\ \}}
\DoxyCodeLine{00461\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (time\_order\ \&\ thilb.empty())\ \{\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_ae6116f42e1f17050404974d0d6d3d226}{tconvolve\_init}}();\ \}}
\DoxyCodeLine{00462\ }
\DoxyCodeLine{00463\ \ \ \ \ \ \ \textcolor{comment}{//\ Get\ view\ of\ helper\ matrices\ based\ on\ time\_order\ flag}}
\DoxyCodeLine{00464\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ hilb\_v\ \ \ =\ (time\_order\ ?\ nda::matrix\_const\_view<double>(thilb)\ :\ nda::matrix\_const\_view<double>(hilb));}
\DoxyCodeLine{00465\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ tcf2it\_v\ =\ (time\_order\ ?\ nda::matrix\_const\_view<double>(ttcf2it)\ :\ nda::matrix\_const\_view<double>(tcf2it));}
\DoxyCodeLine{00466\ }
\DoxyCodeLine{00467\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}\ (T::rank\ ==\ 1)\ \{\ \textcolor{comment}{//\ Scalar-\/valued\ Green's\ function}}
\DoxyCodeLine{00468\ }
\DoxyCodeLine{00469\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ First\ construct\ convolution\ matrix\ from\ DLR\ coefficients\ to\ DLR\ grid}}
\DoxyCodeLine{00470\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ values}}
\DoxyCodeLine{00471\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ fconv\ =\ nda::matrix<S>(r,\ r);\ \textcolor{comment}{//\ Matrix\ of\ convolution\ by\ f}}
\DoxyCodeLine{00472\ }
\DoxyCodeLine{00473\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Diagonal\ contribution\ (given\ by\ diag(tau\_k)\ *\ K(tau\_k,\ om\_l)\ *\ diag(fc\_l))}}
\DoxyCodeLine{00474\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ k\ =\ 0;\ k\ <\ r;\ ++k)\ \{}
\DoxyCodeLine{00475\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ l\ =\ 0;\ l\ <\ r;\ ++l)\ \{\ fconv(k,\ l)\ =\ tcf2it\_v(k,\ l)\ *\ fc(l);\ \}}
\DoxyCodeLine{00476\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00477\ }
\DoxyCodeLine{00478\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Off-\/diagonal\ contribution\ (given\ by\ K\ *\ (diag(hilb*fc)\ +}}
\DoxyCodeLine{00479\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ (diag(fc)*hilb)),\ where\ K\ is\ the\ matrix\ K(dlr\_it(k),\ dlr\_rf(l))}}
\DoxyCodeLine{00480\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ tmp1\ =\ matvecmul(hilb\_v,\ fc);\ \textcolor{comment}{//\ hilb\ *\ fc}}
\DoxyCodeLine{00481\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ tmp2\ =\ nda::matrix<S>(r,\ r);}
\DoxyCodeLine{00482\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ k\ =\ 0;\ k\ <\ r;\ ++k)\ \{}
\DoxyCodeLine{00483\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ l\ =\ 0;\ l\ <\ r;\ ++l)\ \{}
\DoxyCodeLine{00484\ \ \ \ \ \ \ \ \ \ \ \ \ tmp2(k,\ l)\ =\ fc(k)\ *\ hilb\_v(k,\ l);\ \textcolor{comment}{//\ diag(fc)\ *\ hilb}}
\DoxyCodeLine{00485\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00486\ \ \ \ \ \ \ \ \ \ \ tmp2(k,\ k)\ +=\ tmp1(k);\ \textcolor{comment}{//\ diag(fc)*hilb\ +\ diag(hilb*fc)}}
\DoxyCodeLine{00487\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00488\ \ \ \ \ \ \ \ \ fconv\ +=\ matmul(cf2it,\ tmp2);}
\DoxyCodeLine{00489\ }
\DoxyCodeLine{00490\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Then\ precompose\ with\ DLR\ grid\ values\ to\ DLR\ coefficients\ matrix}}
\DoxyCodeLine{00491\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}\ (nda::is\_complex\_v<S>)\ \{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ getrs\ requires\ matrix\ and\ rhs\ to\ have\ same\ value\ type}}
\DoxyCodeLine{00492\ \ \ \ \ \ \ \ \ \ \ nda::lapack::getrs(transpose(it2cf.zlu),\ fconv,\ it2cf.piv);\ \textcolor{comment}{//\ Note:\ lapack\ effectively\ tranposes\ fconv\ by\ fortran\ reordering\ here}}
\DoxyCodeLine{00493\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00494\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ getrs\ requires\ matrix\ and\ rhs\ to\ have\ same\ value\ type}}
\DoxyCodeLine{00495\ \ \ \ \ \ \ \ \ \ \ nda::lapack::getrs(transpose(it2cf.lu),\ fconv,\ it2cf.piv);}
\DoxyCodeLine{00496\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00497\ }
\DoxyCodeLine{00498\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ beta\ *\ fconv;}
\DoxyCodeLine{00499\ }
\DoxyCodeLine{00500\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (T::rank\ ==\ 3)\ \{\ \textcolor{comment}{//\ Matrix-\/valued\ Green's\ function}}
\DoxyCodeLine{00501\ }
\DoxyCodeLine{00502\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ norb1\ =\ fc.shape(1);}
\DoxyCodeLine{00503\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ norb2\ =\ fc.shape(2);}
\DoxyCodeLine{00504\ }
\DoxyCodeLine{00505\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ First\ construct\ convolution\ matrix\ from\ DLR\ coefficients\ to\ DLR\ grid}}
\DoxyCodeLine{00506\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ values}}
\DoxyCodeLine{00507\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ fconv\ \ \ \ =\ nda::matrix<S>(r\ *\ norb1,\ r\ *\ norb2);\ \ \ \ \textcolor{comment}{//\ Matrix\ of\ convolution\ by\ f}}
\DoxyCodeLine{00508\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ fconv\_rs\ =\ nda::reshape(fconv,\ r,\ norb1,\ r,\ norb2);\ \textcolor{comment}{//\ Array\ view\ to\ index\ into\ fconv\ for\ conevenience}}
\DoxyCodeLine{00509\ }
\DoxyCodeLine{00510\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Diagonal\ contribution\ (given\ by\ diag(tau\_k)\ *\ K(tau\_k,\ om\_l)\ *\ diag(fc\_l))}}
\DoxyCodeLine{00511\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ k\ =\ 0;\ k\ <\ r;\ ++k)\ \{}
\DoxyCodeLine{00512\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ l\ =\ 0;\ l\ <\ r;\ ++l)\ \{\ fconv\_rs(k,\ \_,\ l,\ \_)\ =\ tcf2it\_v(k,\ l)\ *\ fc(l,\ \_,\ \_);\ \}}
\DoxyCodeLine{00513\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00514\ }
\DoxyCodeLine{00515\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Off-\/diagonal\ contribution\ (given\ by\ K\ *\ (diag(hilb*fc)\ +}}
\DoxyCodeLine{00516\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ (diag(fc)*hilb)),\ where\ K\ is\ the\ matrix\ K(dlr\_it(k),\ dlr\_rf(l))}}
\DoxyCodeLine{00517\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ tmp1\ =\ \mbox{\hyperlink{namespacecppdlr_a623b3f78817239e2d1653be8972cc5f1}{arraymult}}(hilb\_v,\ fc);\ \textcolor{comment}{//\ hilb\ *\ fc}}
\DoxyCodeLine{00518\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ tmp2\ =\ nda::array<S,\ 4>(r,\ norb1,\ r,\ norb2);}
\DoxyCodeLine{00519\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ k\ =\ 0;\ k\ <\ r;\ ++k)\ \{}
\DoxyCodeLine{00520\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ l\ =\ 0;\ l\ <\ r;\ ++l)\ \{}
\DoxyCodeLine{00521\ \ \ \ \ \ \ \ \ \ \ \ \ tmp2(k,\ \_,\ l,\ \_)\ =\ fc(k,\ \_,\ \_)\ *\ hilb\_v(k,\ l);\ \textcolor{comment}{//\ diag(fc)\ *\ hilb}}
\DoxyCodeLine{00522\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00523\ \ \ \ \ \ \ \ \ \ \ tmp2(k,\ \_,\ k,\ \_)\ +=\ tmp1(k,\ \_,\ \_);\ \textcolor{comment}{//\ diag(fc)*hilb\ +\ diag(hilb*fc)}}
\DoxyCodeLine{00524\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00525\ \ \ \ \ \ \ \ \ fconv\_rs\ +=\ \mbox{\hyperlink{namespacecppdlr_a623b3f78817239e2d1653be8972cc5f1}{arraymult}}(cf2it,\ tmp2);}
\DoxyCodeLine{00526\ }
\DoxyCodeLine{00527\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Then\ precompose\ with\ DLR\ grid\ values\ to\ DLR\ coefficients\ matrix}}
\DoxyCodeLine{00528\ }
\DoxyCodeLine{00529\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Transpose\ last\ two\ indices\ to\ put\ make\ column\ DLR\ index\ the\ last}}
\DoxyCodeLine{00530\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ index}}
\DoxyCodeLine{00531\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ fconvtmp\ \ \ \ =\ nda::matrix<S>(r\ *\ norb1\ *\ norb2,\ r);}
\DoxyCodeLine{00532\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ fconvtmp\_rs\ =\ nda::reshape(fconvtmp,\ r,\ norb1,\ norb2,\ r);}
\DoxyCodeLine{00533\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ norb2;\ ++i)\ \{}
\DoxyCodeLine{00534\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ k\ =\ 0;\ k\ <\ r;\ ++k)\ \{\ fconvtmp\_rs(\_,\ \_,\ i,\ k)\ =\ fconv\_rs(\_,\ \_,\ k,\ i);\ \}}
\DoxyCodeLine{00535\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00536\ }
\DoxyCodeLine{00537\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Do\ the\ solve}}
\DoxyCodeLine{00538\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}\ (nda::is\_complex\_v<S>)\ \{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ getrs\ requires\ matrix\ and\ rhs\ to\ have\ same\ value\ type}}
\DoxyCodeLine{00539\ \ \ \ \ \ \ \ \ \ \ nda::lapack::getrs(transpose(it2cf.zlu),\ fconvtmp,\ it2cf.piv);\ \textcolor{comment}{//\ Note:\ lapack\ effectively\ tranposes\ fconv\ by\ fortran\ reordering\ here}}
\DoxyCodeLine{00540\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00541\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ getrs\ requires\ matrix\ and\ rhs\ to\ have\ same\ value\ type}}
\DoxyCodeLine{00542\ \ \ \ \ \ \ \ \ \ \ nda::lapack::getrs(transpose(it2cf.lu),\ fconvtmp,\ it2cf.piv);}
\DoxyCodeLine{00543\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00544\ }
\DoxyCodeLine{00545\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Transpose\ back}}
\DoxyCodeLine{00546\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ norb2;\ ++i)\ \{}
\DoxyCodeLine{00547\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ k\ =\ 0;\ k\ <\ r;\ ++k)\ \{\ fconv\_rs(\_,\ \_,\ k,\ i)\ =\ fconvtmp\_rs(\_,\ \_,\ i,\ k);\ \}}
\DoxyCodeLine{00548\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00549\ }
\DoxyCodeLine{00550\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ beta\ *\ fconv;}
\DoxyCodeLine{00551\ }
\DoxyCodeLine{00552\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00553\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}Input\ arrays\ must\ be\ rank\ 1\ (scalar-\/valued\ Green's\ function)\ or\ 3\ (matrix-\/valued\ Green's\ function)."{}});}
\DoxyCodeLine{00554\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00555\ \ \ \ \ \}}
\DoxyCodeLine{00556\ }
\DoxyCodeLine{00578\ \ \ \ \ \textcolor{keyword}{template}\ <nda::MemoryArray\ T,\ nda::Scalar\ S\ =\ nda::get\_value\_t<T>>\ S\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_aaaa4303e1ee0897417308f380bb75de8}{innerprod}}(T\ \textcolor{keyword}{const}\ \&fc,\ T\ \textcolor{keyword}{const}\ \&gc)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00579\ }
\DoxyCodeLine{00580\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (r\ !=\ fc.shape(0)\ ||\ r\ !=\ gc.shape(0))\ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}First\ dim\ of\ input\ arrays\ must\ be\ equal\ to\ DLR\ rank\ r."{}});}
\DoxyCodeLine{00581\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (fc.shape()\ !=\ gc.shape())\ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}Input\ arrays\ must\ have\ the\ same\ shape."{}});}
\DoxyCodeLine{00582\ }
\DoxyCodeLine{00583\ \ \ \ \ \ \ \textcolor{comment}{//\ Initialize\ inner\ product\ matrix,\ if\ it\ hasn't\ been\ done\ already}}
\DoxyCodeLine{00584\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (ipmat.empty())\ \{\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a6ce574cd38bdb5bee21d499710f2e8fa}{innerprod\_init}}();\ \}}
\DoxyCodeLine{00585\ }
\DoxyCodeLine{00586\ \ \ \ \ \ \ S\ ip\ =\ 0;}
\DoxyCodeLine{00587\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}\ (T::rank\ ==\ 1)\ \{\ \textcolor{comment}{//\ Scalar-\/valued\ Green's\ function}}
\DoxyCodeLine{00588\ \ \ \ \ \ \ \ \ ip\ =\ nda::blas::dotc(fc,\ matvecmul(ipmat,\ gc));}
\DoxyCodeLine{00589\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (T::rank\ ==\ 3)\ \{\ \textcolor{comment}{//\ Matrix-\/valued\ Green's\ function}}
\DoxyCodeLine{00590\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ norb\ =\ fc.shape(1);}
\DoxyCodeLine{00591\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Compute\ inner\ product}}
\DoxyCodeLine{00592\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ norb;\ ++i)\ \{}
\DoxyCodeLine{00593\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ j\ =\ 0;\ j\ <\ norb;\ ++j)\ \{\ ip\ +=\ nda::blas::dotc(fc(\_,\ i,\ j),\ matvecmul(ipmat,\ gc(\_,\ i,\ j)));\ \}}
\DoxyCodeLine{00594\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00595\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00596\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}Input\ arrays\ must\ be\ rank\ 1\ (scalar-\/valued\ Green's\ function)\ or\ 3\ (matrix-\/valued\ Green's\ function)."{}});}
\DoxyCodeLine{00597\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00598\ }
\DoxyCodeLine{00599\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ ip;}
\DoxyCodeLine{00600\ \ \ \ \ \}}
\DoxyCodeLine{00601\ }
\DoxyCodeLine{00607\ \ \ \ \ nda::vector\_const\_view<double>\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_ae20e69067cc04e37fe8448e8d1088776}{get\_itnodes}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ dlr\_it;\ \};}
\DoxyCodeLine{00608\ \ \ \ \ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_aec1395480d77a2f400b62171e553b0f4}{get\_itnodes}}(\textcolor{keywordtype}{int}\ i)\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ dlr\_it(i);\ \};}
\DoxyCodeLine{00609\ }
\DoxyCodeLine{00616\ \ \ \ \ nda::vector\_const\_view<double>\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_ae5f9dc847c716f5d8b0ea92d56777263}{get\_rfnodes}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ dlr\_rf;\ \};}
\DoxyCodeLine{00617\ \ \ \ \ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_ac58745b133d7a289d897c920ee89f671}{get\_rfnodes}}(\textcolor{keywordtype}{int}\ i)\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ dlr\_rf(i);\ \};}
\DoxyCodeLine{00618\ }
\DoxyCodeLine{00624\ \ \ \ \ nda::matrix\_const\_view<double>\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a6cb8521ca54bb5efa1464693679185ba}{get\_cf2it}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ cf2it;\ \};}
\DoxyCodeLine{00625\ }
\DoxyCodeLine{00631\ \ \ \ \ nda::matrix\_const\_view<double>\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a44acd4cd20cbe95632534891644f1806}{get\_it2cf\_lu}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ it2cf.lu;\ \};}
\DoxyCodeLine{00632\ }
\DoxyCodeLine{00639\ \ \ \ \ nda::matrix\_const\_view<dcomplex>\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_aa6caeb28e5c8152483d3c133b047b6fe}{get\_it2cf\_zlu}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ it2cf.zlu;\ \};}
\DoxyCodeLine{00640\ }
\DoxyCodeLine{00646\ \ \ \ \ nda::vector\_const\_view<int>\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a44d6669d27cdd0f51d74fa2d7b2885de}{get\_it2cf\_piv}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ it2cf.piv;\ \};}
\DoxyCodeLine{00647\ }
\DoxyCodeLine{00653\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a88f437cb31c98929ab8a1e6dadb174aa}{rank}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ r;\ \}}
\DoxyCodeLine{00654\ \ \ \ \ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a401521dedc309ca12c1ec345da983c80}{lambda}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ lambda\_;\ \}}
\DoxyCodeLine{00655\ }
\DoxyCodeLine{00666\ \ \ \ \ nda::matrix\_const\_view<double>\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a2c9211118869fa15b9d1e3092d97b716}{get\_ipmat}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00667\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (ipmat.empty())\ \{\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a6ce574cd38bdb5bee21d499710f2e8fa}{innerprod\_init}}();\ \}}
\DoxyCodeLine{00668\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ ipmat;}
\DoxyCodeLine{00669\ \ \ \ \ \}}
\DoxyCodeLine{00670\ }
\DoxyCodeLine{00679\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a6257e0b3f43733c5ac06c8af11a47bb3}{convolve\_init}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00680\ }
\DoxyCodeLine{00681\ \ \ \ \ \ \ hilb\ \ \ =\ nda::matrix<double>(r,\ r);}
\DoxyCodeLine{00682\ \ \ \ \ \ \ tcf2it\ =\ nda::matrix<double>(r,\ r);}
\DoxyCodeLine{00683\ }
\DoxyCodeLine{00684\ \ \ \ \ \ \ \textcolor{comment}{//\ "{}Discrete\ Hilbert\ transform"{}\ matrix\ -\/(1-\/delta\_jk)/(dlr\_rf(j)\ -\/}}
\DoxyCodeLine{00685\ \ \ \ \ \ \ \textcolor{comment}{//\ dlr\_rf(k)),\ scaled\ by\ beta}}
\DoxyCodeLine{00686\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ j\ =\ 0;\ j\ <\ r;\ ++j)\ \{}
\DoxyCodeLine{00687\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ k\ =\ 0;\ k\ <\ r;\ ++k)\ \{}
\DoxyCodeLine{00688\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (j\ ==\ k)\ \{}
\DoxyCodeLine{00689\ \ \ \ \ \ \ \ \ \ \ \ \ hilb(j,\ k)\ =\ 0;}
\DoxyCodeLine{00690\ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00691\ \ \ \ \ \ \ \ \ \ \ \ \ hilb(j,\ k)\ =\ 1.0\ /\ (dlr\_rf(j)\ -\/\ dlr\_rf(k));}
\DoxyCodeLine{00692\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00693\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00694\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00695\ }
\DoxyCodeLine{00696\ \ \ \ \ \ \ \textcolor{comment}{//\ Matrix\ which\ applies\ DLR\ coefficients\ to\ imaginary\ time\ grid\ values}}
\DoxyCodeLine{00697\ \ \ \ \ \ \ \textcolor{comment}{//\ transformation\ matrix,\ and\ then\ multiplies\ the\ result\ by\ tau,\ the}}
\DoxyCodeLine{00698\ \ \ \ \ \ \ \textcolor{comment}{//\ imaginary\ time\ variable}}
\DoxyCodeLine{00699\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ j\ =\ 0;\ j\ <\ r;\ ++j)\ \{}
\DoxyCodeLine{00700\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ k\ =\ 0;\ k\ <\ r;\ ++k)\ \{}
\DoxyCodeLine{00701\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (dlr\_it(j)\ >\ 0)\ \{}
\DoxyCodeLine{00702\ \ \ \ \ \ \ \ \ \ \ \ \ tcf2it(j,\ k)\ =\ -\/(dlr\_it(j)\ +\ \mbox{\hyperlink{namespacecppdlr_afc9726e02898098dfff8448f02f5b3c6}{k\_it}}(1.0,\ dlr\_rf(k)))\ *\ cf2it(j,\ k);}
\DoxyCodeLine{00703\ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00704\ \ \ \ \ \ \ \ \ \ \ \ \ tcf2it(j,\ k)\ =\ -\/(dlr\_it(j)\ -\/\ \mbox{\hyperlink{namespacecppdlr_afc9726e02898098dfff8448f02f5b3c6}{k\_it}}(0.0,\ dlr\_rf(k)))\ *\ cf2it(j,\ k);}
\DoxyCodeLine{00705\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00706\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00707\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00708\ \ \ \ \ \}}
\DoxyCodeLine{00709\ }
\DoxyCodeLine{00719\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_ae6116f42e1f17050404974d0d6d3d226}{tconvolve\_init}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00720\ }
\DoxyCodeLine{00721\ \ \ \ \ \ \ thilb\ \ \ =\ nda::matrix<double>(r,\ r);}
\DoxyCodeLine{00722\ \ \ \ \ \ \ ttcf2it\ =\ nda::matrix<double>(r,\ r);}
\DoxyCodeLine{00723\ }
\DoxyCodeLine{00724\ \ \ \ \ \ \ \textcolor{comment}{//\ "{}Discrete\ Hilbert\ transform"{}\ matrix}}
\DoxyCodeLine{00725\ \ \ \ \ \ \ \textcolor{comment}{//\ -\/(1-\/delta\_jk)*K(0,dlr\_rf(k))/(dlr\_rf(j)\ -\/\ dlr\_rf(k))\ for\ time-\/ordered}}
\DoxyCodeLine{00726\ \ \ \ \ \ \ \textcolor{comment}{//\ convolution,\ scaled\ by\ beta}}
\DoxyCodeLine{00727\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ j\ =\ 0;\ j\ <\ r;\ ++j)\ \{}
\DoxyCodeLine{00728\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ k\ =\ 0;\ k\ <\ r;\ ++k)\ \{}
\DoxyCodeLine{00729\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (j\ ==\ k)\ \{}
\DoxyCodeLine{00730\ \ \ \ \ \ \ \ \ \ \ \ \ thilb(j,\ k)\ =\ 0;}
\DoxyCodeLine{00731\ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00732\ \ \ \ \ \ \ \ \ \ \ \ \ thilb(j,\ k)\ =\ \mbox{\hyperlink{namespacecppdlr_afc9726e02898098dfff8448f02f5b3c6}{k\_it}}(0.0,\ dlr\_rf(k))\ /\ (dlr\_rf(k)\ -\/\ dlr\_rf(j));}
\DoxyCodeLine{00733\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00734\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00735\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00736\ }
\DoxyCodeLine{00737\ \ \ \ \ \ \ \textcolor{comment}{//\ Matrix\ which\ applies\ K(0,dlr\_rf(j))\ multiplication,\ then\ DLR}}
\DoxyCodeLine{00738\ \ \ \ \ \ \ \textcolor{comment}{//\ coefficients\ to\ imaginary\ time\ grid\ values\ transformation\ matrix,\ and}}
\DoxyCodeLine{00739\ \ \ \ \ \ \ \textcolor{comment}{//\ then\ multiplies\ the\ result\ by\ tau,\ the\ imaginary\ time\ variable}}
\DoxyCodeLine{00740\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ j\ =\ 0;\ j\ <\ r;\ ++j)\ \{}
\DoxyCodeLine{00741\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ k\ =\ 0;\ k\ <\ r;\ ++k)\ \{}
\DoxyCodeLine{00742\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (dlr\_it(j)\ >\ 0)\ \{}
\DoxyCodeLine{00743\ \ \ \ \ \ \ \ \ \ \ \ \ ttcf2it(j,\ k)\ =\ dlr\_it(j)\ *\ cf2it(j,\ k)\ *\ \mbox{\hyperlink{namespacecppdlr_afc9726e02898098dfff8448f02f5b3c6}{k\_it}}(0.0,\ dlr\_rf(k));}
\DoxyCodeLine{00744\ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00745\ \ \ \ \ \ \ \ \ \ \ \ \ ttcf2it(j,\ k)\ =\ (1\ +\ dlr\_it(j))\ *\ cf2it(j,\ k)\ *\ \mbox{\hyperlink{namespacecppdlr_afc9726e02898098dfff8448f02f5b3c6}{k\_it}}(0.0,\ dlr\_rf(k));}
\DoxyCodeLine{00746\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00747\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00748\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00749\ \ \ \ \ \}}
\DoxyCodeLine{00750\ }
\DoxyCodeLine{00758\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a6ce574cd38bdb5bee21d499710f2e8fa}{innerprod\_init}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00759\ }
\DoxyCodeLine{00760\ \ \ \ \ \ \ ipmat\ =\ nda::matrix<double>(r,\ r);}
\DoxyCodeLine{00761\ }
\DoxyCodeLine{00762\ \ \ \ \ \ \ \textcolor{comment}{//\ Matrix\ of\ inner\ product\ of\ two\ DLR\ expansions}}
\DoxyCodeLine{00763\ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ ssum\ =\ 0;}
\DoxyCodeLine{00764\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ k\ =\ 0;\ k\ <\ r;\ ++k)\ \{}
\DoxyCodeLine{00765\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ l\ =\ 0;\ l\ <\ r;\ ++l)\ \{}
\DoxyCodeLine{00766\ \ \ \ \ \ \ \ \ \ \ ssum\ =\ dlr\_rf(k)\ +\ dlr\_rf(l);}
\DoxyCodeLine{00767\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (ssum\ ==\ 0)\ \{}
\DoxyCodeLine{00768\ \ \ \ \ \ \ \ \ \ \ \ \ ipmat(k,\ l)\ =\ \mbox{\hyperlink{namespacecppdlr_afc9726e02898098dfff8448f02f5b3c6}{k\_it}}(0.0,\ dlr\_rf(k))\ *\ \mbox{\hyperlink{namespacecppdlr_afc9726e02898098dfff8448f02f5b3c6}{k\_it}}(0.0,\ dlr\_rf(l));}
\DoxyCodeLine{00769\ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (std::abs(ssum)\ <\ 1)\ \{}
\DoxyCodeLine{00770\ \ \ \ \ \ \ \ \ \ \ \ \ ipmat(k,\ l)\ =\ -\/\mbox{\hyperlink{namespacecppdlr_afc9726e02898098dfff8448f02f5b3c6}{k\_it}}(0.0,\ dlr\_rf(k))\ *\ \mbox{\hyperlink{namespacecppdlr_afc9726e02898098dfff8448f02f5b3c6}{k\_it}}(0.0,\ dlr\_rf(l))\ *\ std::expm1(-\/ssum)\ /\ ssum;}
\DoxyCodeLine{00771\ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00772\ \ \ \ \ \ \ \ \ \ \ \ \ ipmat(k,\ l)\ =\ (\mbox{\hyperlink{namespacecppdlr_afc9726e02898098dfff8448f02f5b3c6}{k\_it}}(0.0,\ dlr\_rf(k))\ *\ \mbox{\hyperlink{namespacecppdlr_afc9726e02898098dfff8448f02f5b3c6}{k\_it}}(0.0,\ dlr\_rf(l))\ -\/\ \mbox{\hyperlink{namespacecppdlr_afc9726e02898098dfff8448f02f5b3c6}{k\_it}}(1.0,\ dlr\_rf(k))\ *\ \mbox{\hyperlink{namespacecppdlr_afc9726e02898098dfff8448f02f5b3c6}{k\_it}}(1.0,\ dlr\_rf(l)))\ /\ ssum;}
\DoxyCodeLine{00773\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00774\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00775\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00776\ \ \ \ \ \}}
\DoxyCodeLine{00777\ }
\DoxyCodeLine{00787\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a3a47942235e7330cc6d392dc881d256f}{reflect\_init}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00788\ }
\DoxyCodeLine{00789\ \ \ \ \ \ \ refl\ =\ nda::matrix<double>(r,\ r);}
\DoxyCodeLine{00790\ }
\DoxyCodeLine{00791\ \ \ \ \ \ \ \textcolor{comment}{//\ Matrix\ of\ reflection\ acting\ on\ DLR\ coefficients\ and\ returning\ values\ at}}
\DoxyCodeLine{00792\ \ \ \ \ \ \ \textcolor{comment}{//\ DLR\ nodes}}
\DoxyCodeLine{00793\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ r;\ ++i)\ \{}
\DoxyCodeLine{00794\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ j\ =\ 0;\ j\ <\ r;\ ++j)\ \{\ refl(i,\ j)\ =\ \mbox{\hyperlink{namespacecppdlr_afc9726e02898098dfff8448f02f5b3c6}{k\_it}}(-\/dlr\_it(i),\ dlr\_rf(j));\ \}}
\DoxyCodeLine{00795\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00796\ }
\DoxyCodeLine{00797\ \ \ \ \ \ \ \textcolor{comment}{//\ Precompose\ with\ DLR\ values\ to\ coefficients\ matrix}}
\DoxyCodeLine{00798\ \ \ \ \ \ \ nda::lapack::getrs(transpose(it2cf.lu),\ refl,\ it2cf.piv);\ \textcolor{comment}{//\ Lapack\ effectively\ transposes\ refl\ by\ fortran\ reordering\ here}}
\DoxyCodeLine{00799\ \ \ \ \ \}}
\DoxyCodeLine{00800\ }
\DoxyCodeLine{00801\ \ \ \ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{00802\ \ \ \ \ \textcolor{keywordtype}{double}\ lambda\_;}
\DoxyCodeLine{00803\ \ \ \ \ \textcolor{keywordtype}{int}\ r;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00804\ \ \ \ \ nda::vector<double>\ dlr\_rf;\ }
\DoxyCodeLine{00805\ \ \ \ \ nda::vector<double>\ dlr\_it;\ }
\DoxyCodeLine{00806\ \ \ \ \ nda::matrix<double>\ cf2it;\ \ }
\DoxyCodeLine{00807\ }
\DoxyCodeLine{00811\ \ \ \ \ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{00812\ \ \ \ \ \ \ nda::matrix<double>\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a83e9085aca345c3bf889ae006f0fdb3d}{lu}};\ \ \ \ }
\DoxyCodeLine{00813\ \ \ \ \ \ \ nda::matrix<dcomplex>\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a4868c3d774292b4d3610ac3225682bc0}{zlu}};\ }
\DoxyCodeLine{00814\ \ \ \ \ \ \ nda::vector<int>\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a7cd0e6b5498400d3afade53a6ebab389}{piv}};\ \ \ \ \ \ }
\DoxyCodeLine{00815\ \ \ \ \ \}\ it2cf;}
\DoxyCodeLine{00816\ }
\DoxyCodeLine{00817\ \ \ \ \ \textcolor{comment}{//\ Arrays\ used\ for\ dlr\_imtime::convolve}}
\DoxyCodeLine{00818\ \ \ \ \ \textcolor{keyword}{mutable}\ nda::matrix<double>\ hilb;\ \ \ }
\DoxyCodeLine{00819\ \ \ \ \ \textcolor{keyword}{mutable}\ nda::matrix<double>\ tcf2it;\ }
\DoxyCodeLine{00820\ }
\DoxyCodeLine{00821\ \ \ \ \ \textcolor{comment}{//\ Arrays\ used\ for\ dlr\_imtime::tconvolve}}
\DoxyCodeLine{00822\ \ \ \ \ \textcolor{keyword}{mutable}\ nda::matrix<double>\ thilb;\ \ \ }
\DoxyCodeLine{00823\ \ \ \ \ \textcolor{keyword}{mutable}\ nda::matrix<double>\ ttcf2it;\ }
\DoxyCodeLine{00824\ }
\DoxyCodeLine{00825\ \ \ \ \ \textcolor{comment}{//\ Array\ used\ for\ dlr\_imtime::innerprod}}
\DoxyCodeLine{00826\ \ \ \ \ \textcolor{keyword}{mutable}\ nda::matrix<double>\ ipmat;\ }
\DoxyCodeLine{00827\ }
\DoxyCodeLine{00828\ \ \ \ \ \textcolor{comment}{//\ Array\ used\ for\ dlr\_imtime::reflect}}
\DoxyCodeLine{00829\ \ \ \ \ \textcolor{keyword}{mutable}\ nda::matrix<double>\ refl;\ }
\DoxyCodeLine{00830\ }
\DoxyCodeLine{00831\ \ \ \ \ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\ serialization\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00832\ }
\DoxyCodeLine{00833\ \ \ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00834\ }
\DoxyCodeLine{00841\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_af958ce61d0c823b2a356b13c3fa10f3d}{serialize}}(\textcolor{keyword}{auto}\ \&ar)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00842\ \ \ \ \ \ \ ar\ \&\ lambda\_\ \&\ r\ \&\ dlr\_rf\ \&\ dlr\_it\ \&\ cf2it\ \&\ it2cf.lu\ \&\ it2cf.zlu\ \&\ it2cf.piv\ \&\ hilb\ \&\ tcf2it\ \&\ thilb\ \&\ ttcf2it\ \&\ ipmat\ \&\ refl;}
\DoxyCodeLine{00843\ \ \ \ \ \}}
\DoxyCodeLine{00844\ }
\DoxyCodeLine{00852\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_aec5610238537886bb0c62c52c023f7b8}{deserialize}}(\textcolor{keyword}{auto}\ \&ar)\ \{}
\DoxyCodeLine{00853\ \ \ \ \ \ \ ar\ \&\ lambda\_\ \&\ r\ \&\ dlr\_rf\ \&\ dlr\_it\ \&\ cf2it\ \&\ it2cf.lu\ \&\ it2cf.zlu\ \&\ it2cf.piv\ \&\ hilb\ \&\ tcf2it\ \&\ thilb\ \&\ ttcf2it\ \&\ ipmat\ \&\ refl;}
\DoxyCodeLine{00854\ \ \ \ \ \}}
\DoxyCodeLine{00855\ }
\DoxyCodeLine{00856\ \ \ \ \ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\ hdf5\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00857\ }
\DoxyCodeLine{00858\ \ \ \ \ \textcolor{keyword}{static}\ std::string\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a649d9f6c3d257661818c3f473f49f57a}{hdf5\_format}}()\ \{\ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}cppdlr::imtime\_ops"{}};\ \}}
\DoxyCodeLine{00859\ }
\DoxyCodeLine{00860\ \ \ \ \ \textcolor{keyword}{friend}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a0eec6aaaea35d7bba7e92951a0de76db}{h5\_write}}(h5::group\ fg,\ std::string\ \textcolor{keyword}{const}\ \&subgroup\_name,\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops}{imtime\_ops}}\ \textcolor{keyword}{const}\ \&m)\ \{}
\DoxyCodeLine{00861\ }
\DoxyCodeLine{00862\ \ \ \ \ \ \ h5::group\ gr\ =\ fg.create\_group(subgroup\_name);}
\DoxyCodeLine{00863\ \ \ \ \ \ \ write\_hdf5\_format(gr,\ m);}
\DoxyCodeLine{00864\ }
\DoxyCodeLine{00865\ \ \ \ \ \ \ h5::write(gr,\ \textcolor{stringliteral}{"{}lambda"{}},\ m.\mbox{\hyperlink{classcppdlr_1_1imtime__ops_a401521dedc309ca12c1ec345da983c80}{lambda}}());}
\DoxyCodeLine{00866\ \ \ \ \ \ \ h5::write(gr,\ \textcolor{stringliteral}{"{}rf"{}},\ m.\mbox{\hyperlink{classcppdlr_1_1imtime__ops_ae5f9dc847c716f5d8b0ea92d56777263}{get\_rfnodes}}());}
\DoxyCodeLine{00867\ \ \ \ \ \ \ h5::write(gr,\ \textcolor{stringliteral}{"{}it"{}},\ m.\mbox{\hyperlink{classcppdlr_1_1imtime__ops_ae20e69067cc04e37fe8448e8d1088776}{get\_itnodes}}());}
\DoxyCodeLine{00868\ \ \ \ \ \ \ h5::write(gr,\ \textcolor{stringliteral}{"{}cf2it"{}},\ m.\mbox{\hyperlink{classcppdlr_1_1imtime__ops_a6cb8521ca54bb5efa1464693679185ba}{get\_cf2it}}());}
\DoxyCodeLine{00869\ \ \ \ \ \ \ h5::write(gr,\ \textcolor{stringliteral}{"{}it2cf\_lu"{}},\ m.\mbox{\hyperlink{classcppdlr_1_1imtime__ops_a44acd4cd20cbe95632534891644f1806}{get\_it2cf\_lu}}());}
\DoxyCodeLine{00870\ \ \ \ \ \ \ h5::write(gr,\ \textcolor{stringliteral}{"{}it2cf\_piv"{}},\ m.\mbox{\hyperlink{classcppdlr_1_1imtime__ops_a44d6669d27cdd0f51d74fa2d7b2885de}{get\_it2cf\_piv}}());}
\DoxyCodeLine{00871\ \ \ \ \ \}}
\DoxyCodeLine{00872\ }
\DoxyCodeLine{00873\ \ \ \ \ \textcolor{keyword}{friend}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a02e5f8519e54734a74b94226d10e082d}{h5\_read}}(h5::group\ fg,\ std::string\ \textcolor{keyword}{const}\ \&subgroup\_name,\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops}{imtime\_ops}}\ \&m)\ \{}
\DoxyCodeLine{00874\ }
\DoxyCodeLine{00875\ \ \ \ \ \ \ h5::group\ gr\ =\ fg.open\_group(subgroup\_name);}
\DoxyCodeLine{00876\ \ \ \ \ \ \ assert\_hdf5\_format(gr,\ m);}
\DoxyCodeLine{00877\ }
\DoxyCodeLine{00878\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a401521dedc309ca12c1ec345da983c80}{lambda}}\ \ \ \ =\ h5::read<double>(gr,\ \textcolor{stringliteral}{"{}lambda"{}});}
\DoxyCodeLine{00879\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ rf\ \ \ \ \ \ \ \ =\ h5::read<nda::vector<double>>(gr,\ \textcolor{stringliteral}{"{}rf"{}});}
\DoxyCodeLine{00880\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ it\ \ \ \ \ \ \ \ =\ h5::read<nda::vector<double>>(gr,\ \textcolor{stringliteral}{"{}it"{}});}
\DoxyCodeLine{00881\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ cf2it\_\ \ \ \ =\ h5::read<nda::matrix<double>>(gr,\ \textcolor{stringliteral}{"{}cf2it"{}});}
\DoxyCodeLine{00882\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ it2cf\_lu\ \ =\ h5::read<nda::matrix<double>>(gr,\ \textcolor{stringliteral}{"{}it2cf\_lu"{}});}
\DoxyCodeLine{00883\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ it2cf\_piv\ =\ h5::read<nda::vector<int>>(gr,\ \textcolor{stringliteral}{"{}it2cf\_piv"{}});}
\DoxyCodeLine{00884\ }
\DoxyCodeLine{00885\ \ \ \ \ \ \ m\ =\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a8da78cf54d39d48d2be19ad1f146b03c}{imtime\_ops}}(\mbox{\hyperlink{classcppdlr_1_1imtime__ops_a401521dedc309ca12c1ec345da983c80}{lambda}},\ rf,\ it,\ cf2it\_,\ it2cf\_lu,\ it2cf\_piv);}
\DoxyCodeLine{00886\ \ \ \ \ \}}
\DoxyCodeLine{00887\ \ \ \};}
\DoxyCodeLine{00888\ }
\DoxyCodeLine{00889\ \}\ \textcolor{comment}{//\ namespace\ cppdlr}}

\end{DoxyCode}
