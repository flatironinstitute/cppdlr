\doxysection{dlr\+\_\+imtime.\+hpp}
\hypertarget{dlr__imtime_8hpp_source}{}\label{dlr__imtime_8hpp_source}\index{/home/runner/work/cppdlr/cppdlr/c++/cppdlr/dlr\_imtime.hpp@{/home/runner/work/cppdlr/cppdlr/c++/cppdlr/dlr\_imtime.hpp}}
\mbox{\hyperlink{dlr__imtime_8hpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ Copyright\ (c)\ 2022-\/2023\ Simons\ Foundation}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ Copyright\ (c)\ 2023\ Hugo\ Strand}}
\DoxyCodeLine{00003\ \textcolor{comment}{//}}
\DoxyCodeLine{00004\ \textcolor{comment}{//\ Licensed\ under\ the\ Apache\ License,\ Version\ 2.0\ (the\ "{}License"{});}}
\DoxyCodeLine{00005\ \textcolor{comment}{//\ you\ may\ not\ use\ this\ file\ except\ in\ compliance\ with\ the\ License.}}
\DoxyCodeLine{00006\ \textcolor{comment}{//\ You\ may\ obtain\ a\ copy\ of\ the\ License\ at}}
\DoxyCodeLine{00007\ \textcolor{comment}{//}}
\DoxyCodeLine{00008\ \textcolor{comment}{//\ \ \ \ \ http://www.apache.org/licenses/LICENSE-\/2.0.txt}}
\DoxyCodeLine{00009\ \textcolor{comment}{//}}
\DoxyCodeLine{00010\ \textcolor{comment}{//\ Unless\ required\ by\ applicable\ law\ or\ agreed\ to\ in\ writing,\ software}}
\DoxyCodeLine{00011\ \textcolor{comment}{//\ distributed\ under\ the\ License\ is\ distributed\ on\ an\ "{}AS\ IS"{}\ BASIS,}}
\DoxyCodeLine{00012\ \textcolor{comment}{//\ WITHOUT\ WARRANTIES\ OR\ CONDITIONS\ OF\ ANY\ KIND,\ either\ express\ or\ implied.}}
\DoxyCodeLine{00013\ \textcolor{comment}{//\ See\ the\ License\ for\ the\ specific\ language\ governing\ permissions\ and}}
\DoxyCodeLine{00014\ \textcolor{comment}{//\ limitations\ under\ the\ License.}}
\DoxyCodeLine{00015\ \textcolor{comment}{//}}
\DoxyCodeLine{00016\ \textcolor{comment}{//\ Authors:\ Hugo\ U.\ R.\ Strand,\ Nils\ Wentzell,\ Jason\ Kaye}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ <nda/nda.hpp>}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{dlr__kernels_8hpp}{cppdlr/dlr\_kernels.hpp}}"{}}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{dlr__build_8hpp}{cppdlr/dlr\_build.hpp}}"{}}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{utils_8hpp}{cppdlr/utils.hpp}}"{}}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ "{}nda/clef/clef.hpp"{}}}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ <h5/h5.hpp>}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#include\ <nda/h5.hpp>}}
\DoxyCodeLine{00027\ }
\DoxyCodeLine{00028\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacecppdlr}{cppdlr}}\ \{}
\DoxyCodeLine{00029\ }
\DoxyCodeLine{00033\ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ \textcolor{keywordtype}{bool}\ ORDINARY\ =\ \textcolor{keyword}{false},\ TIME\_ORDERED\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00034\ }
\DoxyCodeLine{00044\ \ \ \textcolor{keyword}{class\ }\mbox{\hyperlink{classcppdlr_1_1imtime__ops}{imtime\_ops}}\ \{}
\DoxyCodeLine{00045\ }
\DoxyCodeLine{00046\ \ \ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00055\ \ \ \ \ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a8da78cf54d39d48d2be19ad1f146b03c}{imtime\_ops}}(\textcolor{keywordtype}{double}\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a401521dedc309ca12c1ec345da983c80}{lambda}},\ nda::vector\_const\_view<double>\ dlr\_rf,\ \textcolor{keywordtype}{bool}\ symmetrize);}
\DoxyCodeLine{00056\ }
\DoxyCodeLine{00063\ \ \ \ \ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a8da78cf54d39d48d2be19ad1f146b03c}{imtime\_ops}}(\textcolor{keywordtype}{double}\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a401521dedc309ca12c1ec345da983c80}{lambda}},\ nda::vector\_const\_view<double>\ dlr\_rf);}
\DoxyCodeLine{00064\ }
\DoxyCodeLine{00065\ \ \ \ \ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a43a9b5fb6aeefad7d8ae6865329e69de}{imtime\_ops}}(\textcolor{keywordtype}{double}\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a401521dedc309ca12c1ec345da983c80}{lambda}},\ nda::vector\_const\_view<double>\ dlr\_rf,\ nda::vector\_const\_view<double>\ dlr\_it,\ nda::matrix\_const\_view<double>\ cf2it,}
\DoxyCodeLine{00066\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ nda::matrix\_const\_view<double>\ it2cf\_lu,\ nda::vector\_const\_view<int>\ it2cf\_piv)}
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ :\ lambda\_(\mbox{\hyperlink{classcppdlr_1_1imtime__ops_a401521dedc309ca12c1ec345da983c80}{lambda}}),\ r(dlr\_rf.size()),\ dlr\_rf(dlr\_rf),\ dlr\_it(dlr\_it),\ cf2it(cf2it),\ it2cf\{it2cf\_lu,\ it2cf\_lu,\ it2cf\_piv\}\ \{\};}
\DoxyCodeLine{00068\ }
\DoxyCodeLine{00069\ \ \ \ \ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a8da78cf54d39d48d2be19ad1f146b03c}{imtime\_ops}}()\ =\ \textcolor{keywordflow}{default};}
\DoxyCodeLine{00070\ }
\DoxyCodeLine{00099\ \ \ \ \ \textcolor{keyword}{template}\ <nda::MemoryArray\ T,\ nda::Scalar\ S\ =\ nda::get\_value\_t<T>>\ \textcolor{keyword}{typename}\ T::regular\_type\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_af5bafac0dcc76bd713c732a3792c6e0c}{vals2coefs}}(T\ \textcolor{keyword}{const}\ \&g,\ \textcolor{keywordtype}{bool}\ transpose\ =\ \textcolor{keyword}{false})\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00100\ }
\DoxyCodeLine{00101\ \ \ \ \ \ \ \textcolor{comment}{//\ MemoryArray\ type\ can\ be\ nda\ vector,\ matrix,\ array,\ or\ view\ of\ any\ of}}
\DoxyCodeLine{00102\ \ \ \ \ \ \ \textcolor{comment}{//\ these;\ taking\ a\ regular\_type\ converts,\ for\ example,\ a\ matrix\ view\ to\ a}}
\DoxyCodeLine{00103\ \ \ \ \ \ \ \textcolor{comment}{//\ matrix.}}
\DoxyCodeLine{00104\ }
\DoxyCodeLine{00105\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (r\ !=\ g.shape(0))\ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}First\ dim\ of\ g\ !=\ DLR\ rank\ r."{}});}
\DoxyCodeLine{00106\ }
\DoxyCodeLine{00107\ \ \ \ \ \ \ \textcolor{comment}{//\ Make\ a\ copy\ of\ the\ data\ in\ Fortran\ Layout\ as\ required\ by\ getrs}}
\DoxyCodeLine{00108\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ gf\ =\ nda::array<nda::get\_value\_t<T>,\ nda::get\_rank<T>,\ nda::F\_layout>(g);}
\DoxyCodeLine{00109\ }
\DoxyCodeLine{00110\ \ \ \ \ \ \ \textcolor{comment}{//\ Reshape\ as\ matrix\_view\ with\ r\ rows}}
\DoxyCodeLine{00111\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ gfv\ =\ nda::reshape(gf,\ r,\ g.size()\ /\ r);}
\DoxyCodeLine{00112\ }
\DoxyCodeLine{00113\ \ \ \ \ \ \ \textcolor{comment}{//\ Solve\ linear\ system\ (multiple\ right\ hand\ sides)\ to\ convert\ vals\ -\/>\ coeffs}}
\DoxyCodeLine{00114\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}\ (nda::is\_complex\_v<S>)\ \{\ \textcolor{comment}{//\ getrs\ requires\ matrix\ and\ rhs\ to\ have\ same\ value\ type}}
\DoxyCodeLine{00115\ \ \ \ \ \ \ \ \ transpose\ ?\ nda::lapack::getrs(nda::transpose(it2cf.zlu),\ gfv,\ it2cf.piv)\ :\ nda::lapack::getrs(it2cf.zlu,\ gfv,\ it2cf.piv);}
\DoxyCodeLine{00116\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00117\ \ \ \ \ \ \ \ \ transpose\ ?\ nda::lapack::getrs(nda::transpose(it2cf.lu),\ gfv,\ it2cf.piv)\ :\ nda::lapack::getrs(it2cf.lu,\ gfv,\ it2cf.piv);}
\DoxyCodeLine{00118\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00119\ }
\DoxyCodeLine{00120\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ gf;}
\DoxyCodeLine{00121\ \ \ \ \ \}}
\DoxyCodeLine{00122\ }
\DoxyCodeLine{00131\ \ \ \ \ \textcolor{keyword}{template}\ <nda::MemoryArray\ T,\ nda::Scalar\ S\ =\ nda::get\_value\_t<T>>\ \textcolor{keyword}{typename}\ T::regular\_type\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a6f6d71c061aec134df9edf1255e19dfb}{coefs2vals}}(T\ \textcolor{keyword}{const}\ \&gc)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00132\ }
\DoxyCodeLine{00133\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (r\ !=\ gc.shape(0))\ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}First\ dim\ of\ g\ !=\ DLR\ rank\ r."{}});}
\DoxyCodeLine{00134\ }
\DoxyCodeLine{00135\ \ \ \ \ \ \ \textcolor{comment}{//\ Reshape\ gc\ to\ a\ matrix\ w/\ first\ dimension\ r}}
\DoxyCodeLine{00136\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ gc\_rs\ =\ nda::reshape(gc,\ r,\ gc.size()\ /\ r);}
\DoxyCodeLine{00137\ }
\DoxyCodeLine{00138\ \ \ \ \ \ \ \textcolor{comment}{//\ Apply\ coeffs\ -\/>\ vals\ matrix}}
\DoxyCodeLine{00139\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ g\ =\ cf2it\ *\ nda::matrix\_const\_view<S>(gc\_rs);}
\DoxyCodeLine{00140\ }
\DoxyCodeLine{00141\ \ \ \ \ \ \ \textcolor{comment}{//\ Reshape\ to\ original\ dimensions\ and\ return}}
\DoxyCodeLine{00142\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ nda::reshape(g,\ gc.shape());}
\DoxyCodeLine{00143\ \ \ \ \ \}}
\DoxyCodeLine{00144\ }
\DoxyCodeLine{00159\ \ \ \ \ \textcolor{keyword}{template}\ <nda::MemoryArray\ T,\ nda::Scalar\ S\ =\ nda::get\_value\_t<T>>\ \textcolor{keyword}{auto}\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a12761a877407fc347dc695da4b2d7f3d}{coefs2eval}}(T\ \textcolor{keyword}{const}\ \&gc,\ \textcolor{keywordtype}{double}\ t)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00160\ }
\DoxyCodeLine{00161\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (r\ !=\ gc.shape(0))\ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}First\ dim\ of\ g\ !=\ DLR\ rank\ r."{}});}
\DoxyCodeLine{00162\ }
\DoxyCodeLine{00163\ \ \ \ \ \ \ \textcolor{comment}{//\ Scalar-\/valued\ Green's\ functions\ are\ handled\ differently\ than\ matrix-\/valued\ Green's\ functions}}
\DoxyCodeLine{00164\ }
\DoxyCodeLine{00165\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}\ (T::rank\ ==\ 1)\ \{}
\DoxyCodeLine{00166\ }
\DoxyCodeLine{00167\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ TODO:\ can\ be\ further\ optimized\ to\ reduce\ \#\ exponential\ evals.}}
\DoxyCodeLine{00168\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Evaluate\ DLR\ expansion}}
\DoxyCodeLine{00169\ \ \ \ \ \ \ \ \ S\ g\ =\ 0;}
\DoxyCodeLine{00170\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (t\ >=\ 0)\ \{}
\DoxyCodeLine{00171\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ l\ =\ 0;\ l\ <\ r;\ ++l)\ \{\ g\ +=\ \mbox{\hyperlink{namespacecppdlr_a7dfaf907221eb1768418258421af703f}{k\_it\_abs}}(t,\ dlr\_rf(l))\ *\ gc(l);\ \}}
\DoxyCodeLine{00172\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00173\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ l\ =\ 0;\ l\ <\ r;\ ++l)\ \{\ g\ +=\ \mbox{\hyperlink{namespacecppdlr_a7dfaf907221eb1768418258421af703f}{k\_it\_abs}}(-\/t,\ -\/dlr\_rf(l))\ *\ gc(l);\ \}}
\DoxyCodeLine{00174\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00175\ }
\DoxyCodeLine{00176\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ g;}
\DoxyCodeLine{00177\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00178\ }
\DoxyCodeLine{00179\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Reshape\ gc\ to\ matrix\ w/\ first\ dimension\ r}}
\DoxyCodeLine{00180\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ gc\_rs\ =\ nda::reshape(gc,\ r,\ gc.size()\ /\ r);}
\DoxyCodeLine{00181\ }
\DoxyCodeLine{00182\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Get\ output\ shape}}
\DoxyCodeLine{00183\ \ \ \ \ \ \ \ \ std::array<long,\ T::rank\ -\/\ 1>\ shape\_out;}
\DoxyCodeLine{00184\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ T::rank\ -\/\ 1;\ ++i)\ \{\ shape\_out[i]\ =\ gc.shape(i\ +\ 1);\ \}}
\DoxyCodeLine{00185\ }
\DoxyCodeLine{00186\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Get\ vector\ of\ evaluation\ of\ DLR\ expansion\ at\ a\ point}}
\DoxyCodeLine{00187\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ kvec\ =\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a318b0b4409d0488814bb8db12c8b0611}{build\_evalvec}}(t);}
\DoxyCodeLine{00188\ }
\DoxyCodeLine{00189\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Evaluate\ DLR\ expansion,\ reshape\ to\ original\ dimensions\ (with\ first}}
\DoxyCodeLine{00190\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ dimension\ summed\ out),\ and\ return}}
\DoxyCodeLine{00191\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ nda::reshape(transpose(nda::matrix\_const\_view<S>(gc\_rs))\ *\ kvec,\ shape\_out);}
\DoxyCodeLine{00192\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00193\ \ \ \ \ \}}
\DoxyCodeLine{00194\ }
\DoxyCodeLine{00207\ \ \ \ \ nda::vector<double>\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a318b0b4409d0488814bb8db12c8b0611}{build\_evalvec}}(\textcolor{keywordtype}{double}\ t)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00208\ }
\DoxyCodeLine{00218\ \ \ \ \ \textcolor{keyword}{template}\ <nda::MemoryArray\ T,\ nda::Scalar\ S\ =\ nda::get\_value\_t<T>>}
\DoxyCodeLine{00219\ \ \ \ \ \textcolor{keyword}{typename}\ T::regular\_type\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a6a81a99b2858defa9513a395bd35e2bf}{fitvals2coefs}}(nda::vector\_const\_view<double>\ t,\ T\ \textcolor{keyword}{const}\ \&g)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00220\ }
\DoxyCodeLine{00221\ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ first\ dimension\ of\ g\ equal\ to\ length\ of\ t}}
\DoxyCodeLine{00222\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ n\ =\ t.size();}
\DoxyCodeLine{00223\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (n\ !=\ g.shape(0))\ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}First\ dim\ of\ g\ must\ be\ equal\ to\ length\ of\ t."{}});}
\DoxyCodeLine{00224\ }
\DoxyCodeLine{00225\ \ \ \ \ \ \ \textcolor{comment}{//\ Get\ matrix\ for\ least\ squares\ fitting:\ columns\ are\ DLR\ basis\ functions}}
\DoxyCodeLine{00226\ \ \ \ \ \ \ \textcolor{comment}{//\ evaluating\ at\ data\ points\ t.\ Must\ built\ in\ Fortran\ layout\ for}}
\DoxyCodeLine{00227\ \ \ \ \ \ \ \textcolor{comment}{//\ compatibility\ with\ LAPACK.}}
\DoxyCodeLine{00228\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ kmat\ =\ nda::matrix<S,\ nda::F\_layout>(n,\ r);\ \textcolor{comment}{//\ Make\ sure\ matrix\ has\ same\ scalar\ type\ as\ g}}
\DoxyCodeLine{00229\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ j\ =\ 0;\ j\ <\ r;\ ++j)\ \{}
\DoxyCodeLine{00230\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ n;\ ++i)\ \{\ kmat(i,\ j)\ =\ \mbox{\hyperlink{namespacecppdlr_afc9726e02898098dfff8448f02f5b3c6}{k\_it}}(t(i),\ dlr\_rf(j));\ \}}
\DoxyCodeLine{00231\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00232\ }
\DoxyCodeLine{00233\ \ \ \ \ \ \ \textcolor{comment}{//\ Reshape\ g\ to\ matrix\ w/\ first\ dimension\ n,\ and\ put\ in\ Fortran\ layout\ for}}
\DoxyCodeLine{00234\ \ \ \ \ \ \ \textcolor{comment}{//\ compatibility\ w/\ LAPACK}}
\DoxyCodeLine{00235\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ g\_rs\ =\ nda::matrix<S,\ nda::F\_layout>(nda::reshape(g,\ n,\ g.size()\ /\ n));}
\DoxyCodeLine{00236\ }
\DoxyCodeLine{00237\ \ \ \ \ \ \ \textcolor{comment}{//\ Solve\ least\ squares\ problem\ to\ obtain\ DLR\ coefficients}}
\DoxyCodeLine{00238\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ s\ \ \ =\ nda::vector<double>(r);\ \textcolor{comment}{//\ Singular\ values\ (not\ needed)}}
\DoxyCodeLine{00239\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a88f437cb31c98929ab8a1e6dadb174aa}{rank}}\ =\ 0;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Rank\ of\ system\ matrix\ (not\ needed)}}
\DoxyCodeLine{00240\ \ \ \ \ \ \ nda::lapack::gelss(kmat,\ g\_rs,\ s,\ 0.0,\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a88f437cb31c98929ab8a1e6dadb174aa}{rank}});}
\DoxyCodeLine{00241\ }
\DoxyCodeLine{00242\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ gc\_shape\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ =\ g.shape();\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Output\ shape\ is\ same\ as\ g...}}
\DoxyCodeLine{00243\ \ \ \ \ \ \ gc\_shape[0]\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ =\ r;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ ...with\ first\ dimension\ n\ replaced\ by\ r}}
\DoxyCodeLine{00244\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ gc\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ =\ \textcolor{keyword}{typename}\ T::regular\_type(gc\_shape);\ \textcolor{comment}{//\ Output\ array:\ output\ type\ is\ same\ as\ g}}
\DoxyCodeLine{00245\ \ \ \ \ \ \ reshape(gc,\ r,\ g.size()\ /\ n)\ =\ g\_rs(nda::range(r),\ \_);\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Place\ result\ in\ output\ array}}
\DoxyCodeLine{00246\ }
\DoxyCodeLine{00247\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ gc;}
\DoxyCodeLine{00248\ \ \ \ \ \}}
\DoxyCodeLine{00249\ }
\DoxyCodeLine{00261\ \ \ \ \ \textcolor{keyword}{template}\ <nda::MemoryArray\ T>\ \textcolor{keyword}{typename}\ T::regular\_type\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a0ee9bfed6fc9facf2d25cea9868a3af6}{reflect}}(T\ \textcolor{keyword}{const}\ \&g)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00262\ }
\DoxyCodeLine{00263\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (r\ !=\ g.shape(0))\ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}First\ dim\ of\ g\ !=\ DLR\ rank\ r."{}});}
\DoxyCodeLine{00264\ }
\DoxyCodeLine{00265\ \ \ \ \ \ \ \textcolor{comment}{//\ Initialize\ reflection\ matrix,\ if\ it\ hasn't\ been\ done\ already}}
\DoxyCodeLine{00266\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (refl.empty())\ \{\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a3a47942235e7330cc6d392dc881d256f}{reflect\_init}}();\ \}}
\DoxyCodeLine{00267\ }
\DoxyCodeLine{00268\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}\ (T::rank\ ==\ 1)\ \{\ \textcolor{comment}{//\ Scalar-\/valued\ Green's\ function}}
\DoxyCodeLine{00269\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ matmul(refl,\ g);}
\DoxyCodeLine{00270\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00271\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ gr\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ =\ \textcolor{keyword}{typename}\ T::regular\_type(g.shape());\ \ \ \ \ \ \ \textcolor{comment}{//\ Output\ has\ same\ type/shape\ as\ g}}
\DoxyCodeLine{00272\ \ \ \ \ \ \ \ \ reshape(gr,\ r,\ g.size()\ /\ r)\ =\ matmul(refl,\ reshape(g,\ r,\ g.size()\ /\ r));\ \textcolor{comment}{//\ Reshape,\ matrix\ multiply,\ reshape\ back}}
\DoxyCodeLine{00273\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ gr;}
\DoxyCodeLine{00274\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00275\ \ \ \ \ \}}
\DoxyCodeLine{00276\ }
\DoxyCodeLine{00306\ \ \ \ \ \textcolor{keyword}{template}\ <nda::MemoryArray\ T,\ nda::Scalar\ S\ =\ nda::get\_value\_t<T>>}
\DoxyCodeLine{00307\ \ \ \ \ \textcolor{keyword}{typename}\ T::regular\_type\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_adbf464d1761e4c366166b4bb26f2b9cb}{convolve}}(\textcolor{keywordtype}{double}\ beta,\ T\ \textcolor{keyword}{const}\ \&fc,\ T\ \textcolor{keyword}{const}\ \&gc,\ \textcolor{keywordtype}{bool}\ time\_order\ =\ \textcolor{keyword}{false})\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00308\ }
\DoxyCodeLine{00309\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (r\ !=\ fc.shape(0)\ ||\ r\ !=\ gc.shape(0))\ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}First\ dim\ of\ input\ arrays\ must\ be\ equal\ to\ DLR\ rank\ r."{}});}
\DoxyCodeLine{00310\ }
\DoxyCodeLine{00311\ \ \ \ \ \ \ \textcolor{comment}{//\ Initialize\ convolution,\ if\ it\ hasn't\ been\ done\ already}}
\DoxyCodeLine{00312\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!time\_order\ \&\ hilb.empty())\ \{\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a6257e0b3f43733c5ac06c8af11a47bb3}{convolve\_init}}();\ \}}
\DoxyCodeLine{00313\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (time\_order\ \&\ thilb.empty())\ \{\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_ae6116f42e1f17050404974d0d6d3d226}{tconvolve\_init}}();\ \}}
\DoxyCodeLine{00314\ }
\DoxyCodeLine{00315\ \ \ \ \ \ \ \textcolor{comment}{//\ Get\ view\ of\ helper\ matrices\ based\ on\ time\_order\ flag}}
\DoxyCodeLine{00316\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ hilb\_v\ \ \ =\ (time\_order\ ?\ nda::matrix\_const\_view<double>(thilb)\ :\ nda::matrix\_const\_view<double>(hilb));}
\DoxyCodeLine{00317\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ tcf2it\_v\ =\ (time\_order\ ?\ nda::matrix\_const\_view<double>(ttcf2it)\ :\ nda::matrix\_const\_view<double>(tcf2it));}
\DoxyCodeLine{00318\ }
\DoxyCodeLine{00319\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}\ (T::rank\ ==\ 1)\ \{\ \textcolor{comment}{//\ Scalar-\/valued\ Green's\ function}}
\DoxyCodeLine{00320\ }
\DoxyCodeLine{00321\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Take\ array\ view\ of\ fc\ and\ gc}}
\DoxyCodeLine{00322\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ fca\ =\ nda::array\_const\_view<S,\ 1>(fc);}
\DoxyCodeLine{00323\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ gca\ =\ nda::array\_const\_view<S,\ 1>(gc);}
\DoxyCodeLine{00324\ }
\DoxyCodeLine{00325\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Diagonal\ contribution}}
\DoxyCodeLine{00326\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ h\ =\ matvecmul(tcf2it\_v,\ make\_regular(fca\ *\ gca));}
\DoxyCodeLine{00327\ }
\DoxyCodeLine{00328\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Off-\/diagonal\ contribution}}
\DoxyCodeLine{00329\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ tmp\ =\ fca\ *\ \mbox{\hyperlink{namespacecppdlr_a623b3f78817239e2d1653be8972cc5f1}{arraymult}}(hilb\_v,\ gca)\ +\ gca\ *\ \mbox{\hyperlink{namespacecppdlr_a623b3f78817239e2d1653be8972cc5f1}{arraymult}}(hilb\_v,\ fca);}
\DoxyCodeLine{00330\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ beta\ *\ (h\ +\ matvecmul(cf2it,\ make\_regular(tmp)));}
\DoxyCodeLine{00331\ }
\DoxyCodeLine{00332\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (T::rank\ ==\ 3)\ \{\ \textcolor{comment}{//\ Matrix-\/valued\ Green's\ function}}
\DoxyCodeLine{00333\ }
\DoxyCodeLine{00334\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (fc.shape(2)\ !=\ gc.shape(1))\ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}Input\ array\ dimensions\ incompatible."{}});}
\DoxyCodeLine{00335\ }
\DoxyCodeLine{00336\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Diagonal\ contribution}}
\DoxyCodeLine{00337\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ tmp\ =\ nda::array<S,\ 3>(r,\ fc.shape(1),\ gc.shape(2));\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ m\ x\ p\ temporary\ array}}
\DoxyCodeLine{00338\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ r;\ ++i)\ \{\ tmp(i,\ \_,\ \_)\ =\ matmul(fc(i,\ \_,\ \_),\ gc(i,\ \_,\ \_));\ \}\ \textcolor{comment}{//\ Product\ of\ coefficients\ of\ f\ and\ g}}
\DoxyCodeLine{00339\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ h\ =\ \mbox{\hyperlink{namespacecppdlr_a623b3f78817239e2d1653be8972cc5f1}{arraymult}}(tcf2it\_v,\ tmp);}
\DoxyCodeLine{00340\ }
\DoxyCodeLine{00341\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Off-\/diagonal\ contribution}}
\DoxyCodeLine{00342\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ r;\ ++i)\ \{}
\DoxyCodeLine{00343\ \ \ \ \ \ \ \ \ \ \ tmp(i,\ \_,\ \_)\ =\ matmul(\mbox{\hyperlink{namespacecppdlr_a623b3f78817239e2d1653be8972cc5f1}{arraymult}}(hilb\_v,\ fc)(i,\ \_,\ \_),\ gc(i,\ \_,\ \_))\ +\ matmul(fc(i,\ \_,\ \_),\ \mbox{\hyperlink{namespacecppdlr_a623b3f78817239e2d1653be8972cc5f1}{arraymult}}(hilb\_v,\ gc)(i,\ \_,\ \_));}
\DoxyCodeLine{00344\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00345\ }
\DoxyCodeLine{00346\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ beta\ *\ (h\ +\ \mbox{\hyperlink{namespacecppdlr_a623b3f78817239e2d1653be8972cc5f1}{arraymult}}(cf2it,\ tmp));}
\DoxyCodeLine{00347\ }
\DoxyCodeLine{00348\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00349\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}Input\ arrays\ must\ be\ rank\ 1\ (scalar-\/valued\ Green's\ function)\ or\ 3\ (matrix-\/valued\ Green's\ function)."{}});}
\DoxyCodeLine{00350\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00351\ \ \ \ \ \}}
\DoxyCodeLine{00352\ }
\DoxyCodeLine{00362\ \ \ \ \ \textcolor{keyword}{template}\ <nda::MemoryArray\ T>}
\DoxyCodeLine{00363\ \ \ \ \ [[deprecated(\textcolor{stringliteral}{"{}Use\ convolve(beta,\ fc,\ gc,\ time\_order)\ instead."{}})]]}
\DoxyCodeLine{00364\ \ \ \ \ \textcolor{keyword}{auto}\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a2f85a500e7581631c164287ff5a75329}{convolve}}(\textcolor{keywordtype}{double}\ beta,\ [[maybe\_unused]]\ \mbox{\hyperlink{namespacecppdlr_ad0a7e33d9a03f4986937032c25ee7435}{statistic\_t}}\ statistic,\ T\ \textcolor{keyword}{const}\ \&fc,\ T\ \textcolor{keyword}{const}\ \&gc,\ \textcolor{keywordtype}{bool}\ time\_order\ =\ \textcolor{keyword}{false})\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00365\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_adbf464d1761e4c366166b4bb26f2b9cb}{convolve}}(beta,\ fc,\ gc,\ time\_order);}
\DoxyCodeLine{00366\ \ \ \ \ \}}
\DoxyCodeLine{00367\ }
\DoxyCodeLine{00389\ \ \ \ \ \textcolor{keyword}{template}\ <nda::MemoryMatrix\ Tf,\ nda::MemoryArray\ Tg,\ nda::Scalar\ Sf\ =\ nda::get\_value\_t<Tf>,\ nda::Scalar\ Sg\ =\ nda::get\_value\_t<Tg>,}
\DoxyCodeLine{00390\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ nda::Scalar\ S\ =\ \textcolor{keyword}{typename}\ std::common\_type<Sf,\ Sg>::type>}
\DoxyCodeLine{00391\ \ \ \ \ \textcolor{keyword}{typename}\ Tg::regular\_type\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a87b3e21ae66c97691a4580335795f77f}{convolve}}(Tf\ \textcolor{keyword}{const}\ \&fconv,\ Tg\ \textcolor{keyword}{const}\ \&g)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00392\ }
\DoxyCodeLine{00393\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (r\ !=\ g.shape(0))\ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}First\ dim\ of\ input\ g\ must\ be\ equal\ to\ DLR\ rank\ r."{}});}
\DoxyCodeLine{00394\ }
\DoxyCodeLine{00395\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}\ (Tg::rank\ ==\ 1)\ \{\ \textcolor{comment}{//\ Scalar-\/valued\ Green's\ function}}
\DoxyCodeLine{00396\ }
\DoxyCodeLine{00397\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (fconv.shape(1)\ !=\ g.shape(0))\ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}Input\ array\ dimensions\ incompatible."{}});}
\DoxyCodeLine{00398\ }
\DoxyCodeLine{00399\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ matvecmul(fconv,\ g);}
\DoxyCodeLine{00400\ }
\DoxyCodeLine{00401\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (Tg::rank\ ==\ 3)\ \{\ \textcolor{comment}{//\ Matrix-\/valued\ Green's\ function}}
\DoxyCodeLine{00402\ }
\DoxyCodeLine{00403\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (fconv.shape(1)\ !=\ r\ *\ g.shape(1))\ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}Input\ array\ dimensions\ incompatible."{}});}
\DoxyCodeLine{00404\ }
\DoxyCodeLine{00405\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ norb1\ =\ fconv.shape(0)\ /\ r;}
\DoxyCodeLine{00406\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ norb2\ =\ g.shape(1);}
\DoxyCodeLine{00407\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ norb3\ =\ g.shape(2);}
\DoxyCodeLine{00408\ }
\DoxyCodeLine{00409\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ h\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ =\ nda::array<S,\ 3>(r,\ norb1,\ norb3);}
\DoxyCodeLine{00410\ \ \ \ \ \ \ \ \ reshape(h,\ r\ *\ norb1,\ norb3)\ =\ matmul(fconv,\ reshape(g,\ r\ *\ norb2,\ norb3));}
\DoxyCodeLine{00411\ }
\DoxyCodeLine{00412\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ h;}
\DoxyCodeLine{00413\ }
\DoxyCodeLine{00414\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00415\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}Input\ arrays\ must\ be\ rank\ 1\ (scalar-\/valued\ Green's\ function)\ or\ 3\ (matrix-\/valued\ Green's\ function)."{}});}
\DoxyCodeLine{00416\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00417\ \ \ \ \ \}}
\DoxyCodeLine{00418\ }
\DoxyCodeLine{00463\ \ \ \ \ \textcolor{keyword}{template}\ <nda::MemoryArray\ T,\ nda::Scalar\ S\ =\ nda::get\_value\_t<T>>}
\DoxyCodeLine{00464\ \ \ \ \ nda::matrix<S>\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_aac344326d87caaabff268ca47e0f8427}{convmat}}(\textcolor{keywordtype}{double}\ beta,\ T\ \textcolor{keyword}{const}\ \&fc,\ \textcolor{keywordtype}{bool}\ time\_order\ =\ \textcolor{keyword}{false})\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00465\ }
\DoxyCodeLine{00466\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ n,\ m;}
\DoxyCodeLine{00467\ }
\DoxyCodeLine{00468\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}\ (T::rank\ ==\ 1)\ \{\ \textcolor{comment}{//\ Scalar-\/valued\ Green's\ function}}
\DoxyCodeLine{00469\ \ \ \ \ \ \ \ \ n\ =\ r;}
\DoxyCodeLine{00470\ \ \ \ \ \ \ \ \ m\ =\ r;}
\DoxyCodeLine{00471\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (T::rank\ ==\ 3)\ \{\ \textcolor{comment}{//\ Matrix-\/valued\ Green's\ function}}
\DoxyCodeLine{00472\ \ \ \ \ \ \ \ \ n\ =\ r\ *\ fc.shape(1);}
\DoxyCodeLine{00473\ \ \ \ \ \ \ \ \ m\ =\ r\ *\ fc.shape(2);}
\DoxyCodeLine{00474\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00475\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}Input\ arrays\ must\ be\ rank\ 1\ (scalar-\/valued\ Green's\ function)\ or\ 3\ (matrix-\/valued\ Green's\ function)."{}});}
\DoxyCodeLine{00476\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00477\ }
\DoxyCodeLine{00478\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ fconv\ =\ nda::matrix<S,\ nda::C\_layout>(n,\ m);\ \textcolor{comment}{//\ Matrix\ of\ convolution\ by\ f}}
\DoxyCodeLine{00479\ \ \ \ \ \ \ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_aadebc7d1f47b8f8497c2cca4b0711b69}{convmat\_inplace}}(nda::matrix\_view<S,\ nda::C\_layout>(fconv),\ beta,\ fc,\ time\_order);}
\DoxyCodeLine{00480\ }
\DoxyCodeLine{00481\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ fconv;}
\DoxyCodeLine{00482\ \ \ \ \ \}}
\DoxyCodeLine{00483\ }
\DoxyCodeLine{00493\ \ \ \ \ \textcolor{keyword}{template}\ <nda::MemoryArray\ T>}
\DoxyCodeLine{00494\ \ \ \ \ [[deprecated(\textcolor{stringliteral}{"{}Use\ convmat(beta,\ fc,\ time\_order)\ instead."{}})]]\ \textcolor{keyword}{auto}\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a689f31f5920a60448f6c6421a2aec48d}{convmat}}(\textcolor{keywordtype}{double}\ beta,\ [[maybe\_unused]]\ \mbox{\hyperlink{namespacecppdlr_ad0a7e33d9a03f4986937032c25ee7435}{statistic\_t}}\ statistic,\ T\ \textcolor{keyword}{const}\ \&fc,}
\DoxyCodeLine{00495\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ time\_order\ =\ \textcolor{keyword}{false})\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00496\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_aac344326d87caaabff268ca47e0f8427}{convmat}}(beta,\ fc,\ time\_order);}
\DoxyCodeLine{00497\ \ \ \ \ \}}
\DoxyCodeLine{00498\ }
\DoxyCodeLine{00548\ \ \ \ \ \textcolor{keyword}{template}\ <nda::MemoryArray\ T,\ nda::Scalar\ S\ =\ nda::get\_value\_t<T>>}
\DoxyCodeLine{00549\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_aadebc7d1f47b8f8497c2cca4b0711b69}{convmat\_inplace}}(nda::matrix\_view<S,\ nda::C\_layout>\ fconv,\ \textcolor{keywordtype}{double}\ beta,\ T\ \textcolor{keyword}{const}\ \&fc,\ \textcolor{keywordtype}{bool}\ time\_order\ =\ \textcolor{keyword}{false})\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00550\ }
\DoxyCodeLine{00551\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (r\ !=\ fc.shape(0))\ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}First\ dim\ of\ input\ array\ must\ be\ equal\ to\ DLR\ rank\ r."{}});}
\DoxyCodeLine{00552\ }
\DoxyCodeLine{00553\ \ \ \ \ \ \ \textcolor{comment}{//\ Initialize\ convolution,\ if\ it\ hasn't\ been\ done\ already}}
\DoxyCodeLine{00554\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!time\_order\ \&\ hilb.empty())\ \{\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a6257e0b3f43733c5ac06c8af11a47bb3}{convolve\_init}}();\ \}}
\DoxyCodeLine{00555\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (time\_order\ \&\ thilb.empty())\ \{\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_ae6116f42e1f17050404974d0d6d3d226}{tconvolve\_init}}();\ \}}
\DoxyCodeLine{00556\ }
\DoxyCodeLine{00557\ \ \ \ \ \ \ \textcolor{comment}{//\ Get\ view\ of\ helper\ matrices\ based\ on\ time\_order\ flag}}
\DoxyCodeLine{00558\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ hilb\_v\ \ \ =\ (time\_order\ ?\ nda::matrix\_const\_view<double>(thilb)\ :\ nda::matrix\_const\_view<double>(hilb));}
\DoxyCodeLine{00559\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ tcf2it\_v\ =\ (time\_order\ ?\ nda::matrix\_const\_view<double>(ttcf2it)\ :\ nda::matrix\_const\_view<double>(tcf2it));}
\DoxyCodeLine{00560\ }
\DoxyCodeLine{00561\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}\ (T::rank\ ==\ 1)\ \{\ \textcolor{comment}{//\ Scalar-\/valued\ Green's\ function}}
\DoxyCodeLine{00562\ }
\DoxyCodeLine{00563\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (fconv.shape(0)\ !=\ r\ ||\ fconv.shape(1)\ !=\ r)\ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}Matrix\ shape\ must\ be\ equal\ to\ DLR\ rank\ (r,r)."{}});}
\DoxyCodeLine{00564\ }
\DoxyCodeLine{00565\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Diagonal\ contribution\ (given\ by\ diag(tau\_k)\ *\ K(tau\_k,\ om\_l)\ *\ diag(fc\_l))}}
\DoxyCodeLine{00566\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ k\ =\ 0;\ k\ <\ r;\ ++k)\ \{}
\DoxyCodeLine{00567\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ l\ =\ 0;\ l\ <\ r;\ ++l)\ \{\ fconv(k,\ l)\ =\ tcf2it\_v(k,\ l)\ *\ fc(l);\ \}}
\DoxyCodeLine{00568\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00569\ }
\DoxyCodeLine{00570\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Off-\/diagonal\ contribution\ (given\ by\ K\ *\ (diag(hilb*fc)\ +}}
\DoxyCodeLine{00571\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ (diag(fc)*hilb)),\ where\ K\ is\ the\ matrix\ K(dlr\_it(k),\ dlr\_rf(l))}}
\DoxyCodeLine{00572\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ tmp1\ =\ matvecmul(hilb\_v,\ fc);\ \textcolor{comment}{//\ hilb\ *\ fc}}
\DoxyCodeLine{00573\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ tmp2\ =\ nda::matrix<S>(r,\ r);}
\DoxyCodeLine{00574\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ k\ =\ 0;\ k\ <\ r;\ ++k)\ \{}
\DoxyCodeLine{00575\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ l\ =\ 0;\ l\ <\ r;\ ++l)\ \{}
\DoxyCodeLine{00576\ \ \ \ \ \ \ \ \ \ \ \ \ tmp2(k,\ l)\ =\ fc(k)\ *\ hilb\_v(k,\ l);\ \textcolor{comment}{//\ diag(fc)\ *\ hilb}}
\DoxyCodeLine{00577\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00578\ \ \ \ \ \ \ \ \ \ \ tmp2(k,\ k)\ +=\ tmp1(k);\ \textcolor{comment}{//\ diag(fc)*hilb\ +\ diag(hilb*fc)}}
\DoxyCodeLine{00579\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00580\ \ \ \ \ \ \ \ \ fconv\ +=\ matmul(cf2it,\ tmp2);}
\DoxyCodeLine{00581\ }
\DoxyCodeLine{00582\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Then\ precompose\ with\ DLR\ grid\ values\ to\ DLR\ coefficients\ matrix}}
\DoxyCodeLine{00583\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}\ (nda::is\_complex\_v<S>)\ \{\ \textcolor{comment}{//\ getrs\ requires\ matrix\ and\ rhs\ to\ have\ same\ value\ type}}
\DoxyCodeLine{00584\ \ \ \ \ \ \ \ \ \ \ nda::lapack::getrs(transpose(it2cf.zlu),\ transpose(fconv),}
\DoxyCodeLine{00585\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ it2cf.piv);\ \textcolor{comment}{//\ Note:\ lapack\ effectively\ tranposes\ fconv\ by\ fortran\ reordering\ here}}
\DoxyCodeLine{00586\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00587\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ getrs\ requires\ matrix\ and\ rhs\ to\ have\ same\ value\ type}}
\DoxyCodeLine{00588\ \ \ \ \ \ \ \ \ \ \ nda::lapack::getrs(transpose(it2cf.lu),\ transpose(fconv),\ it2cf.piv);}
\DoxyCodeLine{00589\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00590\ }
\DoxyCodeLine{00591\ \ \ \ \ \ \ \ \ fconv\ *=\ beta;}
\DoxyCodeLine{00592\ }
\DoxyCodeLine{00593\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (T::rank\ ==\ 3)\ \{\ \textcolor{comment}{//\ Matrix-\/valued\ Green's\ function}}
\DoxyCodeLine{00594\ }
\DoxyCodeLine{00595\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ norb1\ =\ fc.shape(1);}
\DoxyCodeLine{00596\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ norb2\ =\ fc.shape(2);}
\DoxyCodeLine{00597\ }
\DoxyCodeLine{00598\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (fconv.shape(0)\ !=\ r\ *\ norb1\ ||\ fconv.shape(1)\ !=\ r\ *\ norb2)}
\DoxyCodeLine{00599\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}Matrix\ shape\ must\ be\ equal\ to\ DLR\ rank\ times\ norbs\ (r*norb1,r*norb2)."{}});}
\DoxyCodeLine{00600\ }
\DoxyCodeLine{00601\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ fconv\_rs\ =\ nda::reshape(fconv,\ r,\ norb1,\ r,\ norb2);\ \textcolor{comment}{//\ Array\ view\ to\ index\ into\ fconv\ for\ convenience}}
\DoxyCodeLine{00602\ }
\DoxyCodeLine{00603\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Diagonal\ contribution\ (given\ by\ diag(tau\_k)\ *\ K(tau\_k,\ om\_l)\ *\ diag(fc\_l))}}
\DoxyCodeLine{00604\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ k\ =\ 0;\ k\ <\ r;\ ++k)\ \{}
\DoxyCodeLine{00605\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ l\ =\ 0;\ l\ <\ r;\ ++l)\ \{\ fconv\_rs(k,\ \_,\ l,\ \_)\ =\ tcf2it\_v(k,\ l)\ *\ fc(l,\ \_,\ \_);\ \}}
\DoxyCodeLine{00606\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00607\ }
\DoxyCodeLine{00608\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Off-\/diagonal\ contribution\ (given\ by\ K\ *\ (diag(hilb*fc)\ +}}
\DoxyCodeLine{00609\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ (diag(fc)*hilb)),\ where\ K\ is\ the\ matrix\ K(dlr\_it(k),\ dlr\_rf(l))}}
\DoxyCodeLine{00610\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ tmp1\ =\ \mbox{\hyperlink{namespacecppdlr_a623b3f78817239e2d1653be8972cc5f1}{arraymult}}(hilb\_v,\ fc);\ \textcolor{comment}{//\ hilb\ *\ fc}}
\DoxyCodeLine{00611\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ tmp2\ =\ nda::array<S,\ 4>(r,\ norb1,\ r,\ norb2);}
\DoxyCodeLine{00612\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ k\ =\ 0;\ k\ <\ r;\ ++k)\ \{}
\DoxyCodeLine{00613\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ l\ =\ 0;\ l\ <\ r;\ ++l)\ \{}
\DoxyCodeLine{00614\ \ \ \ \ \ \ \ \ \ \ \ \ tmp2(k,\ \_,\ l,\ \_)\ =\ fc(k,\ \_,\ \_)\ *\ hilb\_v(k,\ l);\ \textcolor{comment}{//\ diag(fc)\ *\ hilb}}
\DoxyCodeLine{00615\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00616\ \ \ \ \ \ \ \ \ \ \ tmp2(k,\ \_,\ k,\ \_)\ +=\ tmp1(k,\ \_,\ \_);\ \textcolor{comment}{//\ diag(fc)*hilb\ +\ diag(hilb*fc)}}
\DoxyCodeLine{00617\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00618\ \ \ \ \ \ \ \ \ fconv\_rs\ +=\ \mbox{\hyperlink{namespacecppdlr_a623b3f78817239e2d1653be8972cc5f1}{arraymult}}(cf2it,\ tmp2);}
\DoxyCodeLine{00619\ }
\DoxyCodeLine{00620\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Then\ precompose\ with\ DLR\ grid\ values\ to\ DLR\ coefficients\ matrix}}
\DoxyCodeLine{00621\ }
\DoxyCodeLine{00622\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Transpose\ last\ two\ indices\ to\ put\ make\ column\ DLR\ index\ the\ last}}
\DoxyCodeLine{00623\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ index}}
\DoxyCodeLine{00624\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ fconvtmp\ \ \ \ =\ nda::matrix<S>(r\ *\ norb1\ *\ norb2,\ r);}
\DoxyCodeLine{00625\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ fconvtmp\_rs\ =\ nda::reshape(fconvtmp,\ r,\ norb1,\ norb2,\ r);}
\DoxyCodeLine{00626\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ norb2;\ ++i)\ \{}
\DoxyCodeLine{00627\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ k\ =\ 0;\ k\ <\ r;\ ++k)\ \{\ fconvtmp\_rs(\_,\ \_,\ i,\ k)\ =\ fconv\_rs(\_,\ \_,\ k,\ i);\ \}}
\DoxyCodeLine{00628\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00629\ }
\DoxyCodeLine{00630\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Do\ the\ solve}}
\DoxyCodeLine{00631\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}\ (nda::is\_complex\_v<S>)\ \{\ \textcolor{comment}{//\ getrs\ requires\ matrix\ and\ rhs\ to\ have\ same\ value\ type}}
\DoxyCodeLine{00632\ \ \ \ \ \ \ \ \ \ \ nda::lapack::getrs(transpose(it2cf.zlu),\ transpose(fconvtmp),}
\DoxyCodeLine{00633\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ it2cf.piv);\ \textcolor{comment}{//\ Note:\ lapack\ effectively\ tranposes\ fconv\ by\ fortran\ reordering\ here}}
\DoxyCodeLine{00634\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00635\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ getrs\ requires\ matrix\ and\ rhs\ to\ have\ same\ value\ type}}
\DoxyCodeLine{00636\ \ \ \ \ \ \ \ \ \ \ nda::lapack::getrs(transpose(it2cf.lu),\ transpose(fconvtmp),\ it2cf.piv);}
\DoxyCodeLine{00637\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00638\ }
\DoxyCodeLine{00639\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Transpose\ back}}
\DoxyCodeLine{00640\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ norb2;\ ++i)\ \{}
\DoxyCodeLine{00641\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ k\ =\ 0;\ k\ <\ r;\ ++k)\ \{\ fconv\_rs(\_,\ \_,\ k,\ i)\ =\ fconvtmp\_rs(\_,\ \_,\ i,\ k);\ \}}
\DoxyCodeLine{00642\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00643\ }
\DoxyCodeLine{00644\ \ \ \ \ \ \ \ \ fconv\ *=\ beta;}
\DoxyCodeLine{00645\ }
\DoxyCodeLine{00646\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00647\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}Input\ arrays\ must\ be\ rank\ 1\ (scalar-\/valued\ Green's\ function)\ or\ 3\ (matrix-\/valued\ Green's\ function)."{}});}
\DoxyCodeLine{00648\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00649\ \ \ \ \ \}}
\DoxyCodeLine{00650\ }
\DoxyCodeLine{00660\ \ \ \ \ \textcolor{keyword}{template}\ <nda::MemoryArray\ T,\ nda::Scalar\ S\ =\ nda::get\_value\_t<T>>}
\DoxyCodeLine{00661\ \ \ \ \ [[deprecated(\textcolor{stringliteral}{"{}Use\ convmat\_inplace(fconv,\ beta,\ fc,\ time\_order)\ instead."{}})]]\ \textcolor{keywordtype}{void}}
\DoxyCodeLine{00662\ \ \ \ \ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a9f48c8e4b3164985af73fba0fd28b002}{convmat\_inplace}}(nda::matrix\_view<S,\ nda::C\_layout>\ fconv,\ \textcolor{keywordtype}{double}\ beta,\ \mbox{\hyperlink{namespacecppdlr_ad0a7e33d9a03f4986937032c25ee7435}{statistic\_t}}\ statistic,\ T\ \textcolor{keyword}{const}\ \&fc,\ \textcolor{keywordtype}{bool}\ time\_order\ =\ \textcolor{keyword}{false})\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00663\ \ \ \ \ \ \ (void)statistic;\ \textcolor{comment}{//\ Unused\ parameter,\ kept\ for\ backward\ compatibility}}
\DoxyCodeLine{00664\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_aadebc7d1f47b8f8497c2cca4b0711b69}{convmat\_inplace}}(fconv,\ beta,\ fc,\ time\_order);}
\DoxyCodeLine{00665\ \ \ \ \ \}}
\DoxyCodeLine{00666\ }
\DoxyCodeLine{00688\ \ \ \ \ \textcolor{keyword}{template}\ <nda::MemoryArray\ T,\ nda::Scalar\ S\ =\ nda::get\_value\_t<T>>\ S\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_aaaa4303e1ee0897417308f380bb75de8}{innerprod}}(T\ \textcolor{keyword}{const}\ \&fc,\ T\ \textcolor{keyword}{const}\ \&gc)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00689\ }
\DoxyCodeLine{00690\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (r\ !=\ fc.shape(0)\ ||\ r\ !=\ gc.shape(0))\ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}First\ dim\ of\ input\ arrays\ must\ be\ equal\ to\ DLR\ rank\ r."{}});}
\DoxyCodeLine{00691\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (fc.shape()\ !=\ gc.shape())\ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}Input\ arrays\ must\ have\ the\ same\ shape."{}});}
\DoxyCodeLine{00692\ }
\DoxyCodeLine{00693\ \ \ \ \ \ \ \textcolor{comment}{//\ Initialize\ inner\ product\ matrix,\ if\ it\ hasn't\ been\ done\ already}}
\DoxyCodeLine{00694\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (ipmat.empty())\ \{\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a6ce574cd38bdb5bee21d499710f2e8fa}{innerprod\_init}}();\ \}}
\DoxyCodeLine{00695\ }
\DoxyCodeLine{00696\ \ \ \ \ \ \ S\ ip\ =\ 0;}
\DoxyCodeLine{00697\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}\ (T::rank\ ==\ 1)\ \{\ \textcolor{comment}{//\ Scalar-\/valued\ Green's\ function}}
\DoxyCodeLine{00698\ \ \ \ \ \ \ \ \ ip\ =\ nda::blas::dotc(fc,\ matvecmul(ipmat,\ gc));}
\DoxyCodeLine{00699\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (T::rank\ ==\ 3)\ \{\ \textcolor{comment}{//\ Matrix-\/valued\ Green's\ function}}
\DoxyCodeLine{00700\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ norb\ =\ fc.shape(1);}
\DoxyCodeLine{00701\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Compute\ inner\ product}}
\DoxyCodeLine{00702\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ norb;\ ++i)\ \{}
\DoxyCodeLine{00703\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ j\ =\ 0;\ j\ <\ norb;\ ++j)\ \{\ ip\ +=\ nda::blas::dotc(fc(\_,\ i,\ j),\ matvecmul(ipmat,\ gc(\_,\ i,\ j)));\ \}}
\DoxyCodeLine{00704\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00705\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00706\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}Input\ arrays\ must\ be\ rank\ 1\ (scalar-\/valued\ Green's\ function)\ or\ 3\ (matrix-\/valued\ Green's\ function)."{}});}
\DoxyCodeLine{00707\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00708\ }
\DoxyCodeLine{00709\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ ip;}
\DoxyCodeLine{00710\ \ \ \ \ \}}
\DoxyCodeLine{00711\ }
\DoxyCodeLine{00717\ \ \ \ \ nda::vector\_const\_view<double>\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_ae20e69067cc04e37fe8448e8d1088776}{get\_itnodes}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ dlr\_it;\ \};}
\DoxyCodeLine{00718\ \ \ \ \ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_aec1395480d77a2f400b62171e553b0f4}{get\_itnodes}}(\textcolor{keywordtype}{int}\ i)\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ dlr\_it(i);\ \};}
\DoxyCodeLine{00719\ }
\DoxyCodeLine{00726\ \ \ \ \ nda::vector\_const\_view<double>\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_ae5f9dc847c716f5d8b0ea92d56777263}{get\_rfnodes}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ dlr\_rf;\ \};}
\DoxyCodeLine{00727\ \ \ \ \ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_ac58745b133d7a289d897c920ee89f671}{get\_rfnodes}}(\textcolor{keywordtype}{int}\ i)\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ dlr\_rf(i);\ \};}
\DoxyCodeLine{00728\ }
\DoxyCodeLine{00734\ \ \ \ \ nda::matrix\_const\_view<double>\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a6cb8521ca54bb5efa1464693679185ba}{get\_cf2it}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ cf2it;\ \};}
\DoxyCodeLine{00735\ }
\DoxyCodeLine{00741\ \ \ \ \ nda::matrix\_const\_view<double>\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a44acd4cd20cbe95632534891644f1806}{get\_it2cf\_lu}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ it2cf.lu;\ \};}
\DoxyCodeLine{00742\ }
\DoxyCodeLine{00749\ \ \ \ \ nda::matrix\_const\_view<dcomplex>\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_aa6caeb28e5c8152483d3c133b047b6fe}{get\_it2cf\_zlu}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ it2cf.zlu;\ \};}
\DoxyCodeLine{00750\ }
\DoxyCodeLine{00756\ \ \ \ \ nda::vector\_const\_view<int>\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a44d6669d27cdd0f51d74fa2d7b2885de}{get\_it2cf\_piv}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ it2cf.piv;\ \};}
\DoxyCodeLine{00757\ }
\DoxyCodeLine{00763\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a88f437cb31c98929ab8a1e6dadb174aa}{rank}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ r;\ \}}
\DoxyCodeLine{00764\ \ \ \ \ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a401521dedc309ca12c1ec345da983c80}{lambda}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ lambda\_;\ \}}
\DoxyCodeLine{00765\ }
\DoxyCodeLine{00776\ \ \ \ \ nda::matrix\_const\_view<double>\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a2c9211118869fa15b9d1e3092d97b716}{get\_ipmat}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00777\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (ipmat.empty())\ \{\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a6ce574cd38bdb5bee21d499710f2e8fa}{innerprod\_init}}();\ \}}
\DoxyCodeLine{00778\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ ipmat;}
\DoxyCodeLine{00779\ \ \ \ \ \}}
\DoxyCodeLine{00780\ }
\DoxyCodeLine{00789\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a6257e0b3f43733c5ac06c8af11a47bb3}{convolve\_init}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00790\ }
\DoxyCodeLine{00791\ \ \ \ \ \ \ hilb\ \ \ =\ nda::matrix<double>(r,\ r);}
\DoxyCodeLine{00792\ \ \ \ \ \ \ tcf2it\ =\ nda::matrix<double>(r,\ r);}
\DoxyCodeLine{00793\ }
\DoxyCodeLine{00794\ \ \ \ \ \ \ \textcolor{comment}{//\ "{}Discrete\ Hilbert\ transform"{}\ matrix\ -\/(1-\/delta\_jk)/(dlr\_rf(j)\ -\/}}
\DoxyCodeLine{00795\ \ \ \ \ \ \ \textcolor{comment}{//\ dlr\_rf(k)),\ scaled\ by\ beta}}
\DoxyCodeLine{00796\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ j\ =\ 0;\ j\ <\ r;\ ++j)\ \{}
\DoxyCodeLine{00797\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ k\ =\ 0;\ k\ <\ r;\ ++k)\ \{}
\DoxyCodeLine{00798\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (j\ ==\ k)\ \{}
\DoxyCodeLine{00799\ \ \ \ \ \ \ \ \ \ \ \ \ hilb(j,\ k)\ =\ 0;}
\DoxyCodeLine{00800\ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00801\ \ \ \ \ \ \ \ \ \ \ \ \ hilb(j,\ k)\ =\ 1.0\ /\ (dlr\_rf(j)\ -\/\ dlr\_rf(k));}
\DoxyCodeLine{00802\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00803\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00804\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00805\ }
\DoxyCodeLine{00806\ \ \ \ \ \ \ \textcolor{comment}{//\ Matrix\ which\ applies\ DLR\ coefficients\ to\ imaginary\ time\ grid\ values}}
\DoxyCodeLine{00807\ \ \ \ \ \ \ \textcolor{comment}{//\ transformation\ matrix,\ and\ then\ multiplies\ the\ result\ by\ tau,\ the}}
\DoxyCodeLine{00808\ \ \ \ \ \ \ \textcolor{comment}{//\ imaginary\ time\ variable}}
\DoxyCodeLine{00809\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ j\ =\ 0;\ j\ <\ r;\ ++j)\ \{}
\DoxyCodeLine{00810\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ k\ =\ 0;\ k\ <\ r;\ ++k)\ \{}
\DoxyCodeLine{00811\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (dlr\_it(j)\ >\ 0)\ \{}
\DoxyCodeLine{00812\ \ \ \ \ \ \ \ \ \ \ \ \ tcf2it(j,\ k)\ =\ -\/(dlr\_it(j)\ +\ \mbox{\hyperlink{namespacecppdlr_afc9726e02898098dfff8448f02f5b3c6}{k\_it}}(1.0,\ dlr\_rf(k)))\ *\ cf2it(j,\ k);}
\DoxyCodeLine{00813\ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00814\ \ \ \ \ \ \ \ \ \ \ \ \ tcf2it(j,\ k)\ =\ -\/(dlr\_it(j)\ -\/\ \mbox{\hyperlink{namespacecppdlr_afc9726e02898098dfff8448f02f5b3c6}{k\_it}}(0.0,\ dlr\_rf(k)))\ *\ cf2it(j,\ k);}
\DoxyCodeLine{00815\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00816\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00817\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00818\ \ \ \ \ \}}
\DoxyCodeLine{00819\ }
\DoxyCodeLine{00829\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_ae6116f42e1f17050404974d0d6d3d226}{tconvolve\_init}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00830\ }
\DoxyCodeLine{00831\ \ \ \ \ \ \ thilb\ \ \ =\ nda::matrix<double>(r,\ r);}
\DoxyCodeLine{00832\ \ \ \ \ \ \ ttcf2it\ =\ nda::matrix<double>(r,\ r);}
\DoxyCodeLine{00833\ }
\DoxyCodeLine{00834\ \ \ \ \ \ \ \textcolor{comment}{//\ "{}Discrete\ Hilbert\ transform"{}\ matrix}}
\DoxyCodeLine{00835\ \ \ \ \ \ \ \textcolor{comment}{//\ -\/(1-\/delta\_jk)*K(0,dlr\_rf(k))/(dlr\_rf(j)\ -\/\ dlr\_rf(k))\ for\ time-\/ordered}}
\DoxyCodeLine{00836\ \ \ \ \ \ \ \textcolor{comment}{//\ convolution,\ scaled\ by\ beta}}
\DoxyCodeLine{00837\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ j\ =\ 0;\ j\ <\ r;\ ++j)\ \{}
\DoxyCodeLine{00838\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ k\ =\ 0;\ k\ <\ r;\ ++k)\ \{}
\DoxyCodeLine{00839\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (j\ ==\ k)\ \{}
\DoxyCodeLine{00840\ \ \ \ \ \ \ \ \ \ \ \ \ thilb(j,\ k)\ =\ 0;}
\DoxyCodeLine{00841\ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00842\ \ \ \ \ \ \ \ \ \ \ \ \ thilb(j,\ k)\ =\ \mbox{\hyperlink{namespacecppdlr_afc9726e02898098dfff8448f02f5b3c6}{k\_it}}(0.0,\ dlr\_rf(k))\ /\ (dlr\_rf(k)\ -\/\ dlr\_rf(j));}
\DoxyCodeLine{00843\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00844\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00845\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00846\ }
\DoxyCodeLine{00847\ \ \ \ \ \ \ \textcolor{comment}{//\ Matrix\ which\ applies\ K(0,dlr\_rf(j))\ multiplication,\ then\ DLR}}
\DoxyCodeLine{00848\ \ \ \ \ \ \ \textcolor{comment}{//\ coefficients\ to\ imaginary\ time\ grid\ values\ transformation\ matrix,\ and}}
\DoxyCodeLine{00849\ \ \ \ \ \ \ \textcolor{comment}{//\ then\ multiplies\ the\ result\ by\ tau,\ the\ imaginary\ time\ variable}}
\DoxyCodeLine{00850\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ j\ =\ 0;\ j\ <\ r;\ ++j)\ \{}
\DoxyCodeLine{00851\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ k\ =\ 0;\ k\ <\ r;\ ++k)\ \{}
\DoxyCodeLine{00852\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (dlr\_it(j)\ >\ 0)\ \{}
\DoxyCodeLine{00853\ \ \ \ \ \ \ \ \ \ \ \ \ ttcf2it(j,\ k)\ =\ dlr\_it(j)\ *\ cf2it(j,\ k)\ *\ \mbox{\hyperlink{namespacecppdlr_afc9726e02898098dfff8448f02f5b3c6}{k\_it}}(0.0,\ dlr\_rf(k));}
\DoxyCodeLine{00854\ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00855\ \ \ \ \ \ \ \ \ \ \ \ \ ttcf2it(j,\ k)\ =\ (1\ +\ dlr\_it(j))\ *\ cf2it(j,\ k)\ *\ \mbox{\hyperlink{namespacecppdlr_afc9726e02898098dfff8448f02f5b3c6}{k\_it}}(0.0,\ dlr\_rf(k));}
\DoxyCodeLine{00856\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00857\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00858\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00859\ \ \ \ \ \}}
\DoxyCodeLine{00860\ }
\DoxyCodeLine{00868\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a6ce574cd38bdb5bee21d499710f2e8fa}{innerprod\_init}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00869\ }
\DoxyCodeLine{00870\ \ \ \ \ \ \ ipmat\ =\ nda::matrix<double>(r,\ r);}
\DoxyCodeLine{00871\ }
\DoxyCodeLine{00872\ \ \ \ \ \ \ \textcolor{comment}{//\ Matrix\ of\ inner\ product\ of\ two\ DLR\ expansions}}
\DoxyCodeLine{00873\ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ ssum\ =\ 0;}
\DoxyCodeLine{00874\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ k\ =\ 0;\ k\ <\ r;\ ++k)\ \{}
\DoxyCodeLine{00875\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ l\ =\ 0;\ l\ <\ r;\ ++l)\ \{}
\DoxyCodeLine{00876\ \ \ \ \ \ \ \ \ \ \ ssum\ =\ dlr\_rf(k)\ +\ dlr\_rf(l);}
\DoxyCodeLine{00877\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (ssum\ ==\ 0)\ \{}
\DoxyCodeLine{00878\ \ \ \ \ \ \ \ \ \ \ \ \ ipmat(k,\ l)\ =\ \mbox{\hyperlink{namespacecppdlr_afc9726e02898098dfff8448f02f5b3c6}{k\_it}}(0.0,\ dlr\_rf(k))\ *\ \mbox{\hyperlink{namespacecppdlr_afc9726e02898098dfff8448f02f5b3c6}{k\_it}}(0.0,\ dlr\_rf(l));}
\DoxyCodeLine{00879\ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (std::abs(ssum)\ <\ 1)\ \{}
\DoxyCodeLine{00880\ \ \ \ \ \ \ \ \ \ \ \ \ ipmat(k,\ l)\ =\ -\/\mbox{\hyperlink{namespacecppdlr_afc9726e02898098dfff8448f02f5b3c6}{k\_it}}(0.0,\ dlr\_rf(k))\ *\ \mbox{\hyperlink{namespacecppdlr_afc9726e02898098dfff8448f02f5b3c6}{k\_it}}(0.0,\ dlr\_rf(l))\ *\ std::expm1(-\/ssum)\ /\ ssum;}
\DoxyCodeLine{00881\ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00882\ \ \ \ \ \ \ \ \ \ \ \ \ ipmat(k,\ l)\ =\ (\mbox{\hyperlink{namespacecppdlr_afc9726e02898098dfff8448f02f5b3c6}{k\_it}}(0.0,\ dlr\_rf(k))\ *\ \mbox{\hyperlink{namespacecppdlr_afc9726e02898098dfff8448f02f5b3c6}{k\_it}}(0.0,\ dlr\_rf(l))\ -\/\ \mbox{\hyperlink{namespacecppdlr_afc9726e02898098dfff8448f02f5b3c6}{k\_it}}(1.0,\ dlr\_rf(k))\ *\ \mbox{\hyperlink{namespacecppdlr_afc9726e02898098dfff8448f02f5b3c6}{k\_it}}(1.0,\ dlr\_rf(l)))\ /\ ssum;}
\DoxyCodeLine{00883\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00884\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00885\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00886\ \ \ \ \ \}}
\DoxyCodeLine{00887\ }
\DoxyCodeLine{00897\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a3a47942235e7330cc6d392dc881d256f}{reflect\_init}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00898\ }
\DoxyCodeLine{00899\ \ \ \ \ \ \ refl\ =\ nda::matrix<double>(r,\ r);}
\DoxyCodeLine{00900\ }
\DoxyCodeLine{00901\ \ \ \ \ \ \ \textcolor{comment}{//\ Matrix\ of\ reflection\ acting\ on\ DLR\ coefficients\ and\ returning\ values\ at}}
\DoxyCodeLine{00902\ \ \ \ \ \ \ \textcolor{comment}{//\ DLR\ nodes}}
\DoxyCodeLine{00903\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ r;\ ++i)\ \{}
\DoxyCodeLine{00904\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ j\ =\ 0;\ j\ <\ r;\ ++j)\ \{\ refl(i,\ j)\ =\ \mbox{\hyperlink{namespacecppdlr_afc9726e02898098dfff8448f02f5b3c6}{k\_it}}(-\/dlr\_it(i),\ dlr\_rf(j));\ \}}
\DoxyCodeLine{00905\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00906\ }
\DoxyCodeLine{00907\ \ \ \ \ \ \ \textcolor{comment}{//\ Precompose\ with\ DLR\ values\ to\ coefficients\ matrix}}
\DoxyCodeLine{00908\ \ \ \ \ \ \ nda::lapack::getrs(transpose(it2cf.lu),\ transpose(refl),\ it2cf.piv);\ \textcolor{comment}{//\ Lapack\ effectively\ transposes\ refl\ by\ fortran\ reordering\ here}}
\DoxyCodeLine{00909\ \ \ \ \ \}}
\DoxyCodeLine{00910\ }
\DoxyCodeLine{00911\ \ \ \ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{00912\ \ \ \ \ \textcolor{keywordtype}{double}\ lambda\_;}
\DoxyCodeLine{00913\ \ \ \ \ \textcolor{keywordtype}{int}\ r;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00914\ \ \ \ \ nda::vector<double>\ dlr\_rf;\ }
\DoxyCodeLine{00915\ \ \ \ \ nda::vector<double>\ dlr\_it;\ }
\DoxyCodeLine{00916\ \ \ \ \ nda::matrix<double>\ cf2it;\ \ }
\DoxyCodeLine{00917\ }
\DoxyCodeLine{00921\ \ \ \ \ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{00922\ \ \ \ \ \ \ nda::matrix<double>\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a83e9085aca345c3bf889ae006f0fdb3d}{lu}};\ \ \ \ }
\DoxyCodeLine{00923\ \ \ \ \ \ \ nda::matrix<dcomplex>\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a4868c3d774292b4d3610ac3225682bc0}{zlu}};\ }
\DoxyCodeLine{00924\ \ \ \ \ \ \ nda::vector<int>\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a7cd0e6b5498400d3afade53a6ebab389}{piv}};\ \ \ \ \ \ }
\DoxyCodeLine{00925\ \ \ \ \ \}\ it2cf;}
\DoxyCodeLine{00926\ }
\DoxyCodeLine{00927\ \ \ \ \ \textcolor{comment}{//\ Arrays\ used\ for\ dlr\_imtime::convolve}}
\DoxyCodeLine{00928\ \ \ \ \ \textcolor{keyword}{mutable}\ nda::matrix<double>\ hilb;\ \ \ }
\DoxyCodeLine{00929\ \ \ \ \ \textcolor{keyword}{mutable}\ nda::matrix<double>\ tcf2it;\ }
\DoxyCodeLine{00930\ }
\DoxyCodeLine{00931\ \ \ \ \ \textcolor{comment}{//\ Arrays\ used\ for\ dlr\_imtime::tconvolve}}
\DoxyCodeLine{00932\ \ \ \ \ \textcolor{keyword}{mutable}\ nda::matrix<double>\ thilb;\ \ \ }
\DoxyCodeLine{00933\ \ \ \ \ \textcolor{keyword}{mutable}\ nda::matrix<double>\ ttcf2it;\ }
\DoxyCodeLine{00934\ }
\DoxyCodeLine{00935\ \ \ \ \ \textcolor{comment}{//\ Array\ used\ for\ dlr\_imtime::innerprod}}
\DoxyCodeLine{00936\ \ \ \ \ \textcolor{keyword}{mutable}\ nda::matrix<double>\ ipmat;\ }
\DoxyCodeLine{00937\ }
\DoxyCodeLine{00938\ \ \ \ \ \textcolor{comment}{//\ Array\ used\ for\ dlr\_imtime::reflect}}
\DoxyCodeLine{00939\ \ \ \ \ \textcolor{keyword}{mutable}\ nda::matrix<double>\ refl;\ }
\DoxyCodeLine{00940\ }
\DoxyCodeLine{00941\ \ \ \ \ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\ serialization\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00942\ }
\DoxyCodeLine{00943\ \ \ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00950\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_af958ce61d0c823b2a356b13c3fa10f3d}{serialize}}(\textcolor{keyword}{auto}\ \&ar)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00951\ \ \ \ \ \ \ ar\ \&\ lambda\_\ \&\ r\ \&\ dlr\_rf\ \&\ dlr\_it\ \&\ cf2it\ \&\ it2cf.lu\ \&\ it2cf.zlu\ \&\ it2cf.piv\ \&\ hilb\ \&\ tcf2it\ \&\ thilb\ \&\ ttcf2it\ \&\ ipmat\ \&\ refl;}
\DoxyCodeLine{00952\ \ \ \ \ \}}
\DoxyCodeLine{00953\ }
\DoxyCodeLine{00961\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_aec5610238537886bb0c62c52c023f7b8}{deserialize}}(\textcolor{keyword}{auto}\ \&ar)\ \{}
\DoxyCodeLine{00962\ \ \ \ \ \ \ ar\ \&\ lambda\_\ \&\ r\ \&\ dlr\_rf\ \&\ dlr\_it\ \&\ cf2it\ \&\ it2cf.lu\ \&\ it2cf.zlu\ \&\ it2cf.piv\ \&\ hilb\ \&\ tcf2it\ \&\ thilb\ \&\ ttcf2it\ \&\ ipmat\ \&\ refl;}
\DoxyCodeLine{00963\ \ \ \ \ \}}
\DoxyCodeLine{00964\ }
\DoxyCodeLine{00965\ \ \ \ \ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\ hdf5\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00966\ }
\DoxyCodeLine{00967\ \ \ \ \ \textcolor{keyword}{static}\ std::string\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a649d9f6c3d257661818c3f473f49f57a}{hdf5\_format}}()\ \{\ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}cppdlr::imtime\_ops"{}};\ \}}
\DoxyCodeLine{00968\ }
\DoxyCodeLine{00969\ \ \ \ \ \textcolor{keyword}{friend}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a0eec6aaaea35d7bba7e92951a0de76db}{h5\_write}}(h5::group\ fg,\ std::string\ \textcolor{keyword}{const}\ \&subgroup\_name,\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops}{imtime\_ops}}\ \textcolor{keyword}{const}\ \&m)\ \{}
\DoxyCodeLine{00970\ }
\DoxyCodeLine{00971\ \ \ \ \ \ \ h5::group\ gr\ =\ fg.create\_group(subgroup\_name);}
\DoxyCodeLine{00972\ \ \ \ \ \ \ write\_hdf5\_format(gr,\ m);}
\DoxyCodeLine{00973\ }
\DoxyCodeLine{00974\ \ \ \ \ \ \ h5::write(gr,\ \textcolor{stringliteral}{"{}lambda"{}},\ m.\mbox{\hyperlink{classcppdlr_1_1imtime__ops_a401521dedc309ca12c1ec345da983c80}{lambda}}());}
\DoxyCodeLine{00975\ \ \ \ \ \ \ h5::write(gr,\ \textcolor{stringliteral}{"{}rf"{}},\ m.\mbox{\hyperlink{classcppdlr_1_1imtime__ops_ae5f9dc847c716f5d8b0ea92d56777263}{get\_rfnodes}}());}
\DoxyCodeLine{00976\ \ \ \ \ \ \ h5::write(gr,\ \textcolor{stringliteral}{"{}it"{}},\ m.\mbox{\hyperlink{classcppdlr_1_1imtime__ops_ae20e69067cc04e37fe8448e8d1088776}{get\_itnodes}}());}
\DoxyCodeLine{00977\ \ \ \ \ \ \ h5::write(gr,\ \textcolor{stringliteral}{"{}cf2it"{}},\ m.\mbox{\hyperlink{classcppdlr_1_1imtime__ops_a6cb8521ca54bb5efa1464693679185ba}{get\_cf2it}}());}
\DoxyCodeLine{00978\ \ \ \ \ \ \ h5::write(gr,\ \textcolor{stringliteral}{"{}it2cf\_lu"{}},\ m.\mbox{\hyperlink{classcppdlr_1_1imtime__ops_a44acd4cd20cbe95632534891644f1806}{get\_it2cf\_lu}}());}
\DoxyCodeLine{00979\ \ \ \ \ \ \ h5::write(gr,\ \textcolor{stringliteral}{"{}it2cf\_piv"{}},\ m.\mbox{\hyperlink{classcppdlr_1_1imtime__ops_a44d6669d27cdd0f51d74fa2d7b2885de}{get\_it2cf\_piv}}());}
\DoxyCodeLine{00980\ \ \ \ \ \}}
\DoxyCodeLine{00981\ }
\DoxyCodeLine{00982\ \ \ \ \ \textcolor{keyword}{friend}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a02e5f8519e54734a74b94226d10e082d}{h5\_read}}(h5::group\ fg,\ std::string\ \textcolor{keyword}{const}\ \&subgroup\_name,\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops}{imtime\_ops}}\ \&m)\ \{}
\DoxyCodeLine{00983\ }
\DoxyCodeLine{00984\ \ \ \ \ \ \ h5::group\ gr\ =\ fg.open\_group(subgroup\_name);}
\DoxyCodeLine{00985\ \ \ \ \ \ \ assert\_hdf5\_format(gr,\ m);}
\DoxyCodeLine{00986\ }
\DoxyCodeLine{00987\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a401521dedc309ca12c1ec345da983c80}{lambda}}\ \ \ \ =\ h5::read<double>(gr,\ \textcolor{stringliteral}{"{}lambda"{}});}
\DoxyCodeLine{00988\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ rf\ \ \ \ \ \ \ \ =\ h5::read<nda::vector<double>>(gr,\ \textcolor{stringliteral}{"{}rf"{}});}
\DoxyCodeLine{00989\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ it\ \ \ \ \ \ \ \ =\ h5::read<nda::vector<double>>(gr,\ \textcolor{stringliteral}{"{}it"{}});}
\DoxyCodeLine{00990\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ cf2it\_\ \ \ \ =\ h5::read<nda::matrix<double>>(gr,\ \textcolor{stringliteral}{"{}cf2it"{}});}
\DoxyCodeLine{00991\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ it2cf\_lu\ \ =\ h5::read<nda::matrix<double>>(gr,\ \textcolor{stringliteral}{"{}it2cf\_lu"{}});}
\DoxyCodeLine{00992\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ it2cf\_piv\ =\ h5::read<nda::vector<int>>(gr,\ \textcolor{stringliteral}{"{}it2cf\_piv"{}});}
\DoxyCodeLine{00993\ }
\DoxyCodeLine{00994\ \ \ \ \ \ \ m\ =\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops_a8da78cf54d39d48d2be19ad1f146b03c}{imtime\_ops}}(\mbox{\hyperlink{classcppdlr_1_1imtime__ops_a401521dedc309ca12c1ec345da983c80}{lambda}},\ rf,\ it,\ cf2it\_,\ it2cf\_lu,\ it2cf\_piv);}
\DoxyCodeLine{00995\ \ \ \ \ \}}
\DoxyCodeLine{00996\ \ \ \};}
\DoxyCodeLine{00997\ }
\DoxyCodeLine{00998\ \}\ \textcolor{comment}{//\ namespace\ cppdlr}}

\end{DoxyCode}
