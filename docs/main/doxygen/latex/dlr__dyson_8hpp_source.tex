\doxysection{dlr\+\_\+dyson.\+hpp}
\hypertarget{dlr__dyson_8hpp_source}{}\label{dlr__dyson_8hpp_source}\index{/home/runner/work/cppdlr/cppdlr/c++/cppdlr/dlr\_dyson.hpp@{/home/runner/work/cppdlr/cppdlr/c++/cppdlr/dlr\_dyson.hpp}}
\mbox{\hyperlink{dlr__dyson_8hpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ Copyright\ (c)\ 2023\ Simons\ Foundation}}
\DoxyCodeLine{00002\ \textcolor{comment}{//}}
\DoxyCodeLine{00003\ \textcolor{comment}{//\ Licensed\ under\ the\ Apache\ License,\ Version\ 2.0\ (the\ "{}License"{});}}
\DoxyCodeLine{00004\ \textcolor{comment}{//\ you\ may\ not\ use\ this\ file\ except\ in\ compliance\ with\ the\ License.}}
\DoxyCodeLine{00005\ \textcolor{comment}{//\ You\ may\ obtain\ a\ copy\ of\ the\ License\ at}}
\DoxyCodeLine{00006\ \textcolor{comment}{//}}
\DoxyCodeLine{00007\ \textcolor{comment}{//\ \ \ \ \ http://www.apache.org/licenses/LICENSE-\/2.0.txt}}
\DoxyCodeLine{00008\ \textcolor{comment}{//}}
\DoxyCodeLine{00009\ \textcolor{comment}{//\ Unless\ required\ by\ applicable\ law\ or\ agreed\ to\ in\ writing,\ software}}
\DoxyCodeLine{00010\ \textcolor{comment}{//\ distributed\ under\ the\ License\ is\ distributed\ on\ an\ "{}AS\ IS"{}\ BASIS,}}
\DoxyCodeLine{00011\ \textcolor{comment}{//\ WITHOUT\ WARRANTIES\ OR\ CONDITIONS\ OF\ ANY\ KIND,\ either\ express\ or\ implied.}}
\DoxyCodeLine{00012\ \textcolor{comment}{//\ See\ the\ License\ for\ the\ specific\ language\ governing\ permissions\ and}}
\DoxyCodeLine{00013\ \textcolor{comment}{//\ limitations\ under\ the\ License.}}
\DoxyCodeLine{00014\ \textcolor{comment}{//}}
\DoxyCodeLine{00015\ \textcolor{comment}{//\ Authors:\ Jason\ Kaye}}
\DoxyCodeLine{00016\ }
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}nda/layout\_transforms.hpp"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ <nda/nda.hpp>}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{dlr__imtime_8hpp}{cppdlr/dlr\_imtime.hpp}}>}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{dlr__kernels_8hpp}{cppdlr/dlr\_kernels.hpp}}>}}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ <nda/linalg/eigenelements.hpp>}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ <type\_traits>}}
\DoxyCodeLine{00025\ }
\DoxyCodeLine{00026\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacecppdlr}{cppdlr}}\ \{}
\DoxyCodeLine{00027\ }
\DoxyCodeLine{00034\ \ \ \textcolor{comment}{//\ Type\ of\ Hamiltonian,\ and\ scalar\ type\ of\ Hamiltonian}}
\DoxyCodeLine{00035\ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ Ht,\ nda::Scalar\ Sh\ =\ std::conditional\_t<std::\textcolor{keywordtype}{float}ing\_po\textcolor{keywordtype}{int}<Ht>,\ Ht,\ nda::get\_value\_t<Ht>>>}
\DoxyCodeLine{00036\ \ \ \ \ \textcolor{keyword}{requires}(std::floating\_point<Ht>\ ||\ nda::MemoryMatrix<Ht>)}
\DoxyCodeLine{00037\ \ \ \textcolor{keyword}{class}\ \mbox{\hyperlink{classcppdlr_1_1dyson__it}{dyson\_it}}\ \{}
\DoxyCodeLine{00038\ }
\DoxyCodeLine{00039\ \ \ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00052\ \ \ \ \ \mbox{\hyperlink{classcppdlr_1_1dyson__it_ad74dd68fd0e0a186d621c3a9997ae3cd}{dyson\_it}}(\textcolor{keywordtype}{double}\ beta,\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops}{imtime\_ops}}\ itops,\ Ht\ \textcolor{keyword}{const}\ \&h,\ \textcolor{keywordtype}{double}\ mu\ =\ 0,\ \textcolor{keywordtype}{bool}\ time\_order\ =\ \textcolor{keyword}{false})}
\DoxyCodeLine{00053\ \ \ \ \ \ \ \ :\ beta(beta),\ itops\_ptr(std::make\_shared<\mbox{\hyperlink{classcppdlr_1_1imtime__ops}{imtime\_ops}}>(itops)),\ time\_order(time\_order)\ \{}
\DoxyCodeLine{00054\ }
\DoxyCodeLine{00055\ \ \ \ \ \ \ \textcolor{comment}{//\ dyson\_it\ object\ contains\ a\ shared\ pointer\ to\ the\ imtime\_ops\ object}}
\DoxyCodeLine{00056\ \ \ \ \ \ \ \textcolor{comment}{//\ itops.\ This\ is\ done\ to\ avoid\ making\ a\ copy\ of\ itops,\ which\ is\ meant\ to}}
\DoxyCodeLine{00057\ \ \ \ \ \ \ \textcolor{comment}{//\ handle\ all\ imaginary\ time\ operations\ on\ the\ given\ DLR\ imaginary\ time}}
\DoxyCodeLine{00058\ \ \ \ \ \ \ \textcolor{comment}{//\ grid.}}
\DoxyCodeLine{00059\ }
\DoxyCodeLine{00060\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ r\ \ \ \ =\ itops\_ptr-\/>rank();\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ DLR\ rank}}
\DoxyCodeLine{00061\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ g0\ \ =\ \mbox{\hyperlink{namespacecppdlr_a02424caf43ace0c3330b2fa03f706400}{free\_gf}}(beta,\ itops,\ h,\ mu,\ time\_order);\ \textcolor{comment}{//\ Free\ Green's\ function\ (right\ hand\ side\ of\ Dyson\ equation}}
\DoxyCodeLine{00062\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ g0c\ =\ itops\_ptr-\/>vals2coefs(g0);\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ DLR\ coefficients\ of\ free\ Green's\ function}}
\DoxyCodeLine{00063\ }
\DoxyCodeLine{00064\ \ \ \ \ \ \ \textcolor{comment}{//\ Get\ matrix\ of\ convolution\ by\ free\ Green's\ function}}
\DoxyCodeLine{00065\ \ \ \ \ \ \ g0mat\ =\ itops\_ptr-\/>convmat(beta,\ g0c,\ time\_order);}
\DoxyCodeLine{00066\ }
\DoxyCodeLine{00067\ \ \ \ \ \ \ \textcolor{comment}{//\ Get\ right\ hand\ side\ of\ Dyson\ equation}}
\DoxyCodeLine{00068\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}\ (std::floating\_point<Ht>)\ \{\ \textcolor{comment}{//\ If\ h\ is\ real\ scalar,\ rhs\ is\ a\ vector}}
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \ norb\ =\ 1;}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \ \ rhs\ \ =\ g0;}
\DoxyCodeLine{00071\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{\ \textcolor{comment}{//\ Otherwise,\ rhs\ is\ given\ by\ g0\ w/\ some\ indices\ transposed\ (for\ compatibility\ w/\ LAPACK)}}
\DoxyCodeLine{00072\ \ \ \ \ \ \ \ \ norb\ =\ h.shape(0);}
\DoxyCodeLine{00073\ \ \ \ \ \ \ \ \ rhs.resize(norb,\ r,\ norb);}
\DoxyCodeLine{00074\ \ \ \ \ \ \ \ \ rhs\ =\ permuted\_indices\_view<nda::encode<3>(\{1,\ 2,\ 0\})>(g0);}
\DoxyCodeLine{00075\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00076\ \ \ \ \ \}}
\DoxyCodeLine{00077\ }
\DoxyCodeLine{00089\ \ \ \ \ \mbox{\hyperlink{classcppdlr_1_1dyson__it_ac13a90181eaf068f3d403186d8f55de3}{dyson\_it}}(\textcolor{keywordtype}{double}\ beta,\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops}{imtime\_ops}}\ itops,\ Ht\ \textcolor{keyword}{const}\ \&h,\ \textcolor{keywordtype}{bool}\ time\_order)\ :\ \mbox{\hyperlink{classcppdlr_1_1dyson__it}{dyson\_it}}(beta,\ itops,\ h,\ 0,\ time\_order)\{\};}
\DoxyCodeLine{00090\ }
\DoxyCodeLine{00102\ \ \ \ \ \textcolor{comment}{//\ Tsig\ is\ type\ of\ sig.\ Tg\ is\ type\ of\ Green's}}
\DoxyCodeLine{00103\ \ \ \ \ \textcolor{comment}{//\ function,\ which\ is\ of\ type\ Tsig,\ with\ scalar\ type\ replaced\ by\ the\ common}}
\DoxyCodeLine{00104\ \ \ \ \ \textcolor{comment}{//\ type\ of\ the\ Hamiltonian's\ scalar\ type,\ and\ the\ self-\/energy's\ scalar\ type}}
\DoxyCodeLine{00105\ \ \ \ \ \textcolor{comment}{//\ (real\ if\ both\ are\ real,\ complex\ otherwise).}}
\DoxyCodeLine{00106\ \ \ \ \ \textcolor{keyword}{template}\ <nda::MemoryArray\ Tsig,\ nda::MemoryArray\ Tg\ =\ make\_common\_t<Tsig,\ Sh,\ nda::get\_value\_t<Tsig>>>\ Tg\ \mbox{\hyperlink{classcppdlr_1_1dyson__it_abe3b805dd90827fb5aad110a8c931609}{solve}}(Tsig\ \textcolor{keyword}{const}\ \&sig)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00107\ }
\DoxyCodeLine{00108\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ r\ \ \ \ \ =\ itops\_ptr-\/>rank();\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ DLR\ rank}}
\DoxyCodeLine{00109\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ sigc\ =\ itops\_ptr-\/>vals2coefs(sig);\ \textcolor{comment}{//\ DLR\ coefficients\ of\ self-\/energy}}
\DoxyCodeLine{00110\ }
\DoxyCodeLine{00111\ \ \ \ \ \ \ \textcolor{comment}{//\ Obtain\ Dyson\ equation\ system\ matrix\ I\ -\/\ G0\ *\ Sig,\ where\ G0\ and\ Sig\ are\ the}}
\DoxyCodeLine{00112\ \ \ \ \ \ \ \textcolor{comment}{//\ matrices\ of\ convolution\ by\ the\ free\ Green's\ function\ and\ self-\/energy,}}
\DoxyCodeLine{00113\ \ \ \ \ \ \ \textcolor{comment}{//\ respectively.}}
\DoxyCodeLine{00114\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ sysmat\ =\ make\_regular(nda::eye<double>(r\ *\ norb)\ -\/\ g0mat\ *\ itops\_ptr-\/>convmat(beta,\ sigc,\ time\_order));}
\DoxyCodeLine{00115\ }
\DoxyCodeLine{00116\ \ \ \ \ \ \ \textcolor{comment}{//\ Factorize\ system\ matrix}}
\DoxyCodeLine{00117\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ ipiv\ =\ nda::vector<int>(r\ *\ norb);}
\DoxyCodeLine{00118\ \ \ \ \ \ \ nda::lapack::getrf(sysmat,\ ipiv);}
\DoxyCodeLine{00119\ }
\DoxyCodeLine{00120\ \ \ \ \ \ \ \textcolor{comment}{//\ Solve\ Dyson\ equation}}
\DoxyCodeLine{00121\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ g\ \ \ \ =\ Tg(sig.shape());\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Declare\ Green's\ function}}
\DoxyCodeLine{00122\ \ \ \ \ \ \ g\ \ \ \ \ \ \ \ \ =\ rhs;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Get\ right\ hand\ side\ of\ Dyson\ equation}}
\DoxyCodeLine{00123\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ g\_rs\ =\ nda::matrix\_view<nda::get\_value\_t<Tg>>(nda::reshape(g,\ norb,\ r\ *\ norb));\ \textcolor{comment}{//\ Reshape\ g\ to\ be\ compatible\ w/\ LAPACK}}
\DoxyCodeLine{00124\ \ \ \ \ \ \ nda::lapack::getrs(sysmat,\ g\_rs,\ ipiv);\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Back\ solve}}
\DoxyCodeLine{00125\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}\ (std::floating\_point<Ht>)\ \{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ h\ is\ scalar,\ g\ is\ scalar-\/valued}}
\DoxyCodeLine{00126\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ g;}
\DoxyCodeLine{00127\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{\ \textcolor{comment}{//\ Otherwise,\ g\ is\ matrix-\/valued,\ and\ need\ to\ transpose\ some\ indices\ after\ solve\ to\ undo\ LAPACK\ formatting}}
\DoxyCodeLine{00128\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ permuted\_indices\_view<nda::encode<3>(\{2,\ 0,\ 1\})>(g);}
\DoxyCodeLine{00129\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00130\ \ \ \ \ \}}
\DoxyCodeLine{00131\ }
\DoxyCodeLine{00132\ \ \ \ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{00133\ \ \ \ \ \textcolor{keywordtype}{double}\ beta;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00134\ \ \ \ \ std::shared\_ptr<imtime\_ops>\ itops\_ptr;\ }
\DoxyCodeLine{00135\ \ \ \ \ \textcolor{keywordtype}{int}\ norb;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00136\ \ \ \ \ \textcolor{keywordtype}{bool}\ time\_order;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00137\ }
\DoxyCodeLine{00138\ \ \ \ \ \textcolor{keyword}{typename}\ std::conditional\_t<std::floating\_point<Ht>,\ nda::array<Sh,\ 1>,\ nda::array<Sh,\ 3>>}
\DoxyCodeLine{00139\ \ \ \ \ \ \ \ rhs;\ }
\DoxyCodeLine{00140\ \ \ \ \ nda::matrix<Sh>\ g0mat;\ }
\DoxyCodeLine{00141\ \ \ \};}
\DoxyCodeLine{00142\ }
\DoxyCodeLine{00163\ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ Ht>}
\DoxyCodeLine{00164\ \ \ \ \ \textcolor{keyword}{requires}(std::floating\_point<Ht>\ ||\ nda::MemoryMatrix<Ht>)}
\DoxyCodeLine{00165\ \ \ \textcolor{comment}{//\ If\ h\ is\ scalar,\ return\ scalar-\/valued\ Green's\ function;\ if\ h\ is\ matrix,}}
\DoxyCodeLine{00166\ \ \ \textcolor{comment}{//\ return\ matrix-\/valued\ Green's\ function}}
\DoxyCodeLine{00167\ \ \ \textcolor{keyword}{auto}\ \mbox{\hyperlink{namespacecppdlr_a02424caf43ace0c3330b2fa03f706400}{free\_gf}}(\textcolor{keywordtype}{double}\ beta,\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops}{imtime\_ops}}\ \textcolor{keyword}{const}\ \&itops,\ Ht\ \textcolor{keyword}{const}\ \&h,\ \textcolor{keywordtype}{double}\ mu\ =\ 0,\ \textcolor{keywordtype}{bool}\ time\_order\ =\ \textcolor{keyword}{false})\ \{}
\DoxyCodeLine{00168\ }
\DoxyCodeLine{00169\ \ \ \ \ \textcolor{keywordtype}{int}\ r\ =\ itops.\mbox{\hyperlink{classcppdlr_1_1imtime__ops_a88f437cb31c98929ab8a1e6dadb174aa}{rank}}();}
\DoxyCodeLine{00170\ }
\DoxyCodeLine{00171\ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}\ (std::floating\_point<Ht>)\ \{\ \textcolor{comment}{//\ If\ h\ is\ scalar,\ return\ scalar-\/valued\ Green's\ function}}
\DoxyCodeLine{00172\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ g\ =\ nda::array<Ht,\ 1>(r);}
\DoxyCodeLine{00173\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!time\_order)\ \{\ \textcolor{comment}{//\ Free\ Green's\ function\ for\ ordinary\ Dyson\ equation}}
\DoxyCodeLine{00174\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ r;\ i++)\ \{\ g(i)\ =\ \mbox{\hyperlink{namespacecppdlr_afc9726e02898098dfff8448f02f5b3c6}{k\_it}}(itops.\mbox{\hyperlink{classcppdlr_1_1imtime__ops_ae20e69067cc04e37fe8448e8d1088776}{get\_itnodes}}(i),\ h\ -\/\ mu,\ beta);\ \}}
\DoxyCodeLine{00175\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{\ \textcolor{comment}{//\ Free\ Green's\ function\ for\ time-\/ordered\ Dyson\ equation}}
\DoxyCodeLine{00176\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ r;\ i++)\ \{\ g(i)\ =\ -\/exp(-\/beta\ *\ itops.\mbox{\hyperlink{classcppdlr_1_1imtime__ops_ae20e69067cc04e37fe8448e8d1088776}{get\_itnodes}}(i)\ *\ (h\ -\/\ mu));\ \}}
\DoxyCodeLine{00177\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00178\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ g;}
\DoxyCodeLine{00179\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{\ \textcolor{comment}{//\ Otherwise,\ return\ matrix-\/valued\ Green's\ function}}
\DoxyCodeLine{00180\ }
\DoxyCodeLine{00181\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ norb\ =\ h.shape(0);}
\DoxyCodeLine{00182\ }
\DoxyCodeLine{00183\ \ \ \ \ \ \ \textcolor{comment}{//\ Diagonalize\ Hamiltonian}}
\DoxyCodeLine{00184\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ [eval,\ evec]\ =\ nda::linalg::eigenelements(h);}
\DoxyCodeLine{00185\ }
\DoxyCodeLine{00186\ \ \ \ \ \ \ \textcolor{comment}{//\ Get\ free\ Green's\ function}}
\DoxyCodeLine{00187\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ g\ =\ nda::array<nda::get\_value\_t<Ht>,\ 3>(r,\ norb,\ norb);}
\DoxyCodeLine{00188\ \ \ \ \ \ \ g\ \ \ \ \ \ =\ 0;}
\DoxyCodeLine{00189\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ r;\ i++)\ \{}
\DoxyCodeLine{00190\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!time\_order)\ \{}
\DoxyCodeLine{00191\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ j\ =\ 0;\ j\ <\ norb;\ j++)\ \{\ g(i,\ j,\ j)\ =\ \mbox{\hyperlink{namespacecppdlr_afc9726e02898098dfff8448f02f5b3c6}{k\_it}}(itops.\mbox{\hyperlink{classcppdlr_1_1imtime__ops_ae20e69067cc04e37fe8448e8d1088776}{get\_itnodes}}(i),\ eval(j)\ -\/\ mu,\ beta);\ \}}
\DoxyCodeLine{00192\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00193\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ j\ =\ 0;\ j\ <\ norb;\ j++)\ \{\ g(i,\ j,\ j)\ =\ -\/exp(-\/beta\ *\ \mbox{\hyperlink{namespacecppdlr_a3b1ccba6393dfc517757677a13ad2553}{rel2abs}}(itops.\mbox{\hyperlink{classcppdlr_1_1imtime__ops_ae20e69067cc04e37fe8448e8d1088776}{get\_itnodes}}(i))\ *\ (eval(j)\ -\/\ mu));\ \}}
\DoxyCodeLine{00194\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00195\ \ \ \ \ \ \ \ \ g(i,\ \_,\ \_)\ =\ matmul(evec,\ matmul(g(i,\ \_,\ \_),\ transpose(conj(evec))));}
\DoxyCodeLine{00196\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00197\ }
\DoxyCodeLine{00198\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ g;}
\DoxyCodeLine{00199\ \ \ \ \ \}}
\DoxyCodeLine{00200\ \ \ \}}
\DoxyCodeLine{00201\ }
\DoxyCodeLine{00221\ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ Ht>}
\DoxyCodeLine{00222\ \ \ \ \ \textcolor{keyword}{requires}(std::floating\_point<Ht>\ ||\ nda::MemoryMatrix<Ht>)}
\DoxyCodeLine{00223\ \ \ \textcolor{comment}{//\ If\ h\ is\ scalar,\ return\ scalar-\/valued\ Green's\ function;\ if\ h\ is\ matrix,}}
\DoxyCodeLine{00224\ \ \ \textcolor{comment}{//\ return\ matrix-\/valued\ Green's\ function}}
\DoxyCodeLine{00225\ \ \ \textcolor{keyword}{auto}\ \mbox{\hyperlink{namespacecppdlr_a02424caf43ace0c3330b2fa03f706400}{free\_gf}}(\textcolor{keywordtype}{double}\ beta,\ \mbox{\hyperlink{classcppdlr_1_1imtime__ops}{imtime\_ops}}\ \textcolor{keyword}{const}\ \&itops,\ Ht\ \textcolor{keyword}{const}\ \&h,\ \textcolor{keywordtype}{bool}\ time\_order)\ \{}
\DoxyCodeLine{00226\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{namespacecppdlr_a02424caf43ace0c3330b2fa03f706400}{free\_gf}}(beta,\ itops,\ h,\ 0,\ time\_order);}
\DoxyCodeLine{00227\ \ \ \};}
\DoxyCodeLine{00228\ }
\DoxyCodeLine{00229\ \}\ \textcolor{comment}{//\ namespace\ cppdlr}}

\end{DoxyCode}
